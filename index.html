<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Asteryxx">
<meta property="og:url" content="https://weibo.com/2414189922/profile?topnav=1&wvr=6/index.html">
<meta property="og:site_name" content="Asteryxx">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Asteryxx">






  <link rel="canonical" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Asteryxx</title>
  <script type="text/javascript" src="/js/src/clicklove.js"></script>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
	<a href="https://github.com/asteryxxx/" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Asteryxx</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2022/06/05/antd的批量导出/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2022/06/05/antd的批量导出/" class="post-title-link" itemprop="url">antd的下拉框批量导出</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2022-06-05 19:28:28" itemprop="dateCreated datePublished" datetime="2022-06-05T19:28:28+08:00">2022-06-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2022-09-06 16:19:15" itemprop="dateModified" datetime="2022-09-06T16:19:15+08:00">2022-09-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/antd/" itemprop="url" rel="index"><span itemprop="name">antd</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>工作中需要批量的导出多种情况的要求，于是这里做个笔记，这里设计到了antd的Menu, Dropdown组件的使用：</strong></p>
<p><img src="../images/antd_batchExports1.png" alt></p>
<p><img src="../images/antd_batchExports2.png" alt></p>
<blockquote>
<p>首先贴一段代码</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件的按钮</span></span><br><span class="line"><span class="comment">// 这里的selectedRow是选中的列表勾选项，这里弄了插槽因为可能不是按钮</span></span><br><span class="line">&lt;ProTable</span><br><span class="line">        className=<span class="string">"txtLibBoxTable"</span></span><br><span class="line">        。。。</span><br><span class="line">        actionRef=&#123;actionRef&#125;</span><br><span class="line">        toolBarRender=&#123;(action, &#123; selectedRows &#125;) =&gt; [</span><br><span class="line">&lt;BatchExport selectedRows=&#123;selectedRows&#125;&gt;</span><br><span class="line">            &lt;Button</span><br><span class="line">              className=<span class="string">'btn4'</span></span><br><span class="line">              key=<span class="string">"batchExportDoc"</span></span><br><span class="line">              onClick=&#123;(e) =&gt; e.preventDefault()&#125;</span><br><span class="line">            &gt;&lt;img src=&#123;manyoutPic&#125; width=&#123;38&#125; height=&#123;38&#125; alt="" /&gt;批量导出&lt;/Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/BatchExport&gt;                                                    ]&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect, useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Checkbox, Radio, Menu, Dropdown, Button, message, Modal &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; expordWord, expordWord2 &#125; <span class="keyword">from</span> <span class="string">'@/pages/DataBases/search/Server'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  exportDocListDirectoryToWord,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../../../../../setting/topicManage/server'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; downloadImage &#125; <span class="keyword">from</span> <span class="string">'../../../../../setting/dataManage/server'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  closePic,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@/pages/DataBases/setting/picutils'</span></span><br><span class="line"><span class="keyword">import</span> Styles <span class="keyword">from</span> <span class="string">'./index.less'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RadioGroup = Radio.Group;</span><br><span class="line"><span class="keyword">const</span> CheckboxGroup = Checkbox.Group;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> plainOptions = [</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'日期'</span>, <span class="attr">value</span>: <span class="string">'日期'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'版名'</span>, <span class="attr">value</span>: <span class="string">'版名'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'标题'</span>, <span class="attr">value</span>: <span class="string">'标题'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'下标题'</span>, <span class="attr">value</span>: <span class="string">'标下题'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'上标题'</span>, <span class="attr">value</span>: <span class="string">'标上题'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'版次'</span>, <span class="attr">value</span>: <span class="string">'版次'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'作者'</span>, <span class="attr">value</span>: <span class="string">'作者'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'库名'</span>, <span class="attr">value</span>: <span class="string">'库名'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'来源'</span>, <span class="attr">value</span>: <span class="string">'来源'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'原文链接'</span>, <span class="attr">value</span>: <span class="string">'原文链接'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'正文'</span>, <span class="attr">value</span>: <span class="string">'正文'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">label</span>: <span class="string">'图片'</span>, <span class="attr">value</span>: <span class="string">'图片'</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// radio的样式</span></span><br><span class="line"><span class="keyword">const</span> radioStyle = &#123;</span><br><span class="line">  display: <span class="string">'block'</span>,</span><br><span class="line">  height: <span class="string">'30px'</span>,</span><br><span class="line">  lineHeight: <span class="string">'30px'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface batchExportProp &#123;</span><br><span class="line">  selectedRows: <span class="built_in">Array</span>&lt;any&gt; | <span class="literal">undefined</span>,</span><br><span class="line">  children: any</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 批量导出的四种情况的组件</span></span><br><span class="line"><span class="keyword">const</span> batchExport = <span class="function">(<span class="params">props: batchExportProp</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; selectedRows, children &#125; = props</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [wordDownloadModalVisible, setWordDownloadModalVisible] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [definedDownloadVisible, setdefinedDownloadVisible] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [wordDownloadType, setWordDownloadType] = useState(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [indeterminate, setIndeterminate] = useState(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> [checkAll, setCheckAll] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [checkedList, setCheckedList] = useState([]);</span><br><span class="line">  <span class="comment">// 选中的行数据</span></span><br><span class="line">  <span class="keyword">const</span> [checkItemList, setCheckItemList] = useState([])</span><br><span class="line">  <span class="comment">// 下载功能选择</span></span><br><span class="line">  <span class="keyword">const</span> MenuonClick = (&#123; key &#125;): <span class="function"><span class="params">any</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果用户没选择列表数据直接报警告！！</span></span><br><span class="line">    <span class="keyword">if</span> (checkItemList.length === <span class="number">0</span>) <span class="keyword">return</span> message.warning(<span class="string">'请选择需要下载的内容'</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">'3'</span> || key === <span class="string">'7'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">'7'</span>) &#123;</span><br><span class="line">        <span class="comment">// word目录</span></span><br><span class="line">        exportDocListDirectoryToWord(checkItemList)</span><br><span class="line">          .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> url = <span class="built_in">window</span>.URL.createObjectURL(res);</span><br><span class="line">            <span class="keyword">let</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">            <span class="built_in">document</span>.body.appendChild(a);</span><br><span class="line">            <span class="keyword">let</span> fileName = <span class="built_in">Date</span>.now() + <span class="string">'.doc'</span>;</span><br><span class="line">            a.href = url;</span><br><span class="line">            a.download = fileName;</span><br><span class="line">            a.click();</span><br><span class="line">            <span class="built_in">window</span>.URL.revokeObjectURL(url);</span><br><span class="line">            <span class="built_in">document</span>.body.removeChild(a);</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            message.error(<span class="string">'下载失败，请检查网络配置'</span>, <span class="number">5</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">'3'</span>) &#123;</span><br><span class="line">        downloadImage(checkItemList)</span><br><span class="line">          .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 构造下载zip的文件</span></span><br><span class="line">            <span class="keyword">let</span> url = <span class="built_in">window</span>.URL.createObjectURL(res);</span><br><span class="line">            <span class="keyword">let</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">            <span class="built_in">document</span>.body.appendChild(a);</span><br><span class="line">            <span class="keyword">let</span> fileName = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() + <span class="string">'.zip'</span>;</span><br><span class="line">            a.href = url;</span><br><span class="line">            a.download = fileName;</span><br><span class="line">            a.click();</span><br><span class="line">            <span class="built_in">window</span>.URL.revokeObjectURL(url);</span><br><span class="line">            <span class="built_in">document</span>.body.removeChild(a);</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            message.error(<span class="string">'下载失败，请检查网络配置'</span>, <span class="number">5</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下载word弹框</span></span><br><span class="line">  <span class="keyword">const</span> downloadWord = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> checkItemList.length !== <span class="number">0</span> ? setWordDownloadModalVisible(<span class="literal">true</span>) : message.warning(<span class="string">'请选择需要下载的内容'</span>, <span class="number">5</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 自定义下载word弹框</span></span><br><span class="line">  <span class="keyword">const</span> definedDownloadWord = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> checkItemList.length !== <span class="number">0</span> ? setdefinedDownloadVisible(<span class="literal">true</span>) : message.warning(<span class="string">'请选择需要下载的内容'</span>, <span class="number">5</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// word下载确认</span></span><br><span class="line">  <span class="keyword">const</span> handleModalOk = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setWordDownloadModalVisible(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 参数</span></span><br><span class="line">    <span class="keyword">let</span> params = &#123;</span><br><span class="line">      judge: wordDownloadType,</span><br><span class="line">      fields: <span class="string">''</span>,</span><br><span class="line">      isAll: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 多个 txt与文件 zip</span></span><br><span class="line">    expordWord2(checkItemList, params)</span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> url = <span class="built_in">window</span>.URL.createObjectURL(res);</span><br><span class="line">        <span class="keyword">let</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(a);</span><br><span class="line">        <span class="keyword">let</span> fileName = <span class="built_in">Date</span>.now() + <span class="string">'.doc'</span>;</span><br><span class="line">        a.href = url;</span><br><span class="line">        a.download = fileName;</span><br><span class="line">        a.click();</span><br><span class="line">        <span class="built_in">window</span>.URL.revokeObjectURL(url);</span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(a);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        message.error(<span class="string">'下载失败，请检查网络配置'</span>, <span class="number">5</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 自定义 word下载确认</span></span><br><span class="line">  <span class="keyword">const</span> handleModalOk2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setdefinedDownloadVisible(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 参数</span></span><br><span class="line">    <span class="keyword">let</span> params = &#123;</span><br><span class="line">      judge: <span class="literal">true</span>,</span><br><span class="line">      fields: checkedList,</span><br><span class="line">      isAll: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    expordWord(checkItemList, params)</span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 构造下载doc的文件</span></span><br><span class="line">        <span class="keyword">let</span> url = <span class="built_in">window</span>.URL.createObjectURL(res);</span><br><span class="line">        <span class="keyword">let</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(a);</span><br><span class="line">        <span class="keyword">let</span> fileName = <span class="built_in">Date</span>.now() + <span class="string">'.doc'</span>;</span><br><span class="line">        a.href = url;</span><br><span class="line">        a.download = fileName;</span><br><span class="line">        a.click();</span><br><span class="line">        <span class="built_in">window</span>.URL.revokeObjectURL(url);</span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(a);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        message.error(<span class="string">'下载失败，请检查网络配置'</span>, <span class="number">5</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下载下拉菜单html</span></span><br><span class="line">  <span class="comment">// 【菜单使用 Menu，还包括菜单项 Menu.Item，分割线 Menu.Divider】</span></span><br><span class="line">  <span class="comment">// 【注意： Menu.Item 必须设置唯一的 key 属性。】</span></span><br><span class="line">  <span class="keyword">const</span> menu = (</span><br><span class="line">    &lt;Menu onClick=&#123;MenuonClick&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/* 这个点击函数会穿个Key就是下面的key,可以根据判断点击了哪个 */</span>&#125;</span><br><span class="line">      &lt;Menu.Item key=<span class="string">"3"</span>&gt;下载(zip)&lt;<span class="regexp">/Menu.Item&gt;</span></span><br><span class="line"><span class="regexp">      &lt;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Menu.Divider /</span>&gt;</span><br><span class="line">        &lt;Menu.Item key=<span class="string">"6"</span> onClick=&#123;() =&gt; downloadWord()&#125;&gt;</span><br><span class="line">          下载(word)</span><br><span class="line">        &lt;<span class="regexp">/Menu.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Menu.Divider /</span>&gt;</span><br><span class="line">        &lt;Menu.Item key=<span class="string">"5"</span> onClick=&#123;() =&gt; definedDownloadWord()&#125;&gt;</span><br><span class="line">          自定义下载(word)</span><br><span class="line">        &lt;<span class="regexp">/Menu.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Menu.Divider /</span>&gt;</span><br><span class="line">        &lt;Menu.Item key=<span class="string">"7"</span>&gt;下载目录(word)&lt;<span class="regexp">/Menu.Item&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/Menu&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 取消</span></span><br><span class="line"><span class="regexp">  const handleCancel = useCallback(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    setWordDownloadModalVisible(false);</span></span><br><span class="line"><span class="regexp">  &#125;, []);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 自定义取消</span></span><br><span class="line"><span class="regexp">  const handleCancel2 = useCallback(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    setdefinedDownloadVisible(false);</span></span><br><span class="line"><span class="regexp">  &#125;, []);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 选择word下载类型</span></span><br><span class="line"><span class="regexp">  const handlerSelectType = (e: any) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    setWordDownloadType(e.target.value);</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 自定义Word下载弹窗的全选事件</span></span><br><span class="line"><span class="regexp">  const onCheckAllChange = (e: any) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const allCheck = [</span></span><br><span class="line"><span class="regexp">      '日期',</span></span><br><span class="line"><span class="regexp">      '版名',</span></span><br><span class="line"><span class="regexp">      '标上题',</span></span><br><span class="line"><span class="regexp">      '标题',</span></span><br><span class="line"><span class="regexp">      '标下题',</span></span><br><span class="line"><span class="regexp">      '版次',</span></span><br><span class="line"><span class="regexp">      '作者',</span></span><br><span class="line"><span class="regexp">      '库名',</span></span><br><span class="line"><span class="regexp">      '来源',</span></span><br><span class="line"><span class="regexp">      '原文链接',</span></span><br><span class="line"><span class="regexp">      '正文',</span></span><br><span class="line"><span class="regexp">      '图片',</span></span><br><span class="line"><span class="regexp">    ];</span></span><br><span class="line"><span class="regexp">    setCheckedList(e.target.checked ? allCheck : []);</span></span><br><span class="line"><span class="regexp">    setIndeterminate(false), setCheckAll(e.target.checked);</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 自定义Word下载弹窗的CheckOnChange事件</span></span><br><span class="line"><span class="regexp">  const handlerCheckOnChange = (checkedList: any) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    setCheckedList(checkedList);</span></span><br><span class="line"><span class="regexp">    setIndeterminate(!!checkedList.length &amp;&amp; checkedList.length &lt; plainOptions.length),</span></span><br><span class="line"><span class="regexp">      setCheckAll(checkedList.length === plainOptions.length);</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 新的批量导出最上面的按钮处理事件函数</span></span><br><span class="line"><span class="regexp">  const handleBatchExportNew = useCallback((e) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    e.preventDefault();</span></span><br><span class="line"><span class="regexp">  &#125;, []);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 传入的数组变了要保存</span></span><br><span class="line"><span class="regexp">    setCheckItemList(selectedRows)</span></span><br><span class="line"><span class="regexp">  &#125;, [selectedRows])</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Dropdown</span></span><br><span class="line"><span class="regexp">        overlayClassName=&#123;'txtLibDropdown'&#125;</span></span><br><span class="line"><span class="regexp">        overlay=&#123;menu&#125;</span></span><br><span class="line"><span class="regexp">        trigger=&#123;['hover']&#125;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ 触发下拉的行为</span></span><br><span class="line"><span class="regexp">        getPopupContainer=&#123;(triggerNode) =&gt; triggerNode.parentNode&#125;</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ 这个函数解决下拉框错位的问题：https:/</span><span class="regexp">/blog.csdn.net/</span>zeng__yi/article/details/<span class="number">83507429</span></span><br><span class="line">      &gt;</span><br><span class="line">        &#123;children&#125;</span><br><span class="line">      &#123;<span class="comment">/*   &lt;Button</span></span><br><span class="line"><span class="comment">          className='btn4'</span></span><br><span class="line"><span class="comment">          key="batchExportDoc"</span></span><br><span class="line"><span class="comment">          onClick=&#123;(e) =&gt; handleBatchExportNew(e)&#125;</span></span><br><span class="line"><span class="comment">        &gt;&lt;img src=&#123;manyoutPic&#125; width=&#123;38&#125; height=&#123;38&#125; alt="" /&gt;批量导出&lt;/Button&gt; */</span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/Dropdown&gt;</span></span><br><span class="line"><span class="regexp">      &#123;/</span>* 下载word弹窗 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">      &lt;Modal</span></span><br><span class="line"><span class="regexp">        closeIcon=&#123;&lt;img src=&#123;closePic&#125; width=&#123;29&#125; height=&#123;29&#125; /</span>&gt;&#125;</span><br><span class="line">        className=&#123;Styles.batchExportBox&#125;</span><br><span class="line">        title=<span class="string">"Word下载"</span></span><br><span class="line">        visible=&#123;wordDownloadModalVisible&#125;</span><br><span class="line">        onOk=&#123;handleModalOk&#125;</span><br><span class="line">        onCancel=&#123;handleCancel&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;RadioGroup onChange=&#123;handlerSelectType&#125; value=&#123;wordDownloadType&#125;&gt;</span><br><span class="line">          &lt;Radio style=&#123;radioStyle&#125; value=&#123;<span class="literal">true</span>&#125;&gt;</span><br><span class="line">            带原文链接下载</span><br><span class="line">          &lt;<span class="regexp">/Radio&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Radio style=&#123;radioStyle&#125; value=&#123;false&#125;&gt;</span></span><br><span class="line"><span class="regexp">            不带原文链接下载</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Radio&gt;</span><br><span class="line">        &lt;<span class="regexp">/RadioGroup&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Modal&gt;</span><br><span class="line">      &#123;<span class="comment">/* 自定义Word下载弹窗 */</span>&#125;</span><br><span class="line">      &lt;Modal</span><br><span class="line">        closeIcon=&#123;&lt;img src=&#123;closePic&#125; width=&#123;<span class="number">29</span>&#125; height=&#123;<span class="number">29</span>&#125; /&gt;&#125;</span><br><span class="line">        className=&#123;Styles.batchExportBox&#125;</span><br><span class="line">        title=<span class="string">"自定义Word下载"</span></span><br><span class="line">        visible=&#123;definedDownloadVisible&#125;</span><br><span class="line">        onOk=&#123;handleModalOk2&#125;</span><br><span class="line">        onCancel=&#123;handleCancel2&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;div style=&#123;&#123; <span class="attr">borderBottom</span>: <span class="string">'1px solid #E9E9E9'</span> &#125;&#125;&gt;</span><br><span class="line">          &lt;Checkbox indeterminate=&#123;indeterminate&#125; onChange=&#123;onCheckAllChange&#125; checked=&#123;checkAll&#125;&gt;</span><br><span class="line">            全选</span><br><span class="line">          &lt;<span class="regexp">/Checkbox&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;CheckboxGroup options=&#123;plainOptions&#125; value=&#123;checkedList&#125; onChange=&#123;handlerCheckOnChange&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Modal&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    &lt;/</span>&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.memo(batchExport)</span><br></pre></td></tr></table></figure>
<p>参考资料：</p>
<p><a href="https://ant.design/components/dropdown-cn/" target="_blank" rel="noopener">https://ant.design/components/dropdown-cn/</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2022/06/02/antd的图片裁剪/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2022/06/02/antd的图片裁剪/" class="post-title-link" itemprop="url">antd的图片裁剪</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2022-06-02 16:08:28" itemprop="dateCreated datePublished" datetime="2022-06-02T16:08:28+08:00">2022-06-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2022-09-06 16:20:03" itemprop="dateModified" datetime="2022-09-06T16:20:03+08:00">2022-09-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/antd/" itemprop="url" rel="index"><span itemprop="name">antd</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>工作中需要对图片进行图片裁剪的要求，于是这里做个笔记：</strong></p>
<p><img src="../images/antd_pictureCropper1.png" style="zoom:80%;"></p>
<blockquote>
<p>首先贴一段代码，需要安装【react-cropper】这个插件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line">import &apos;./index.less&apos;;</span><br><span class="line">import &#123; Tooltip, Button, Modal, message &#125; from &apos;antd&apos;;</span><br><span class="line">import React, &#123; useRef, useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; closePic &#125; from &apos;@/pages/DataBases/setting/picutils&apos;;</span><br><span class="line">import &#123; useToggleVal &#125; from &apos;@/utils/hook/common&apos;;</span><br><span class="line">import Cropper from &apos;react-cropper&apos; // 引入Cropper</span><br><span class="line">import &apos;cropperjs/dist/cropper.css&apos; // 引入Cropper对应的css</span><br><span class="line">//阿里巴巴矢量图标库引入</span><br><span class="line">import &#123; createFromIconfontCN &#125; from &apos;@ant-design/icons&apos;;</span><br><span class="line">import &#123; uploadImage &#125; from &apos;../../../server&apos;;</span><br><span class="line">import &#123; editDocById &#125; from &apos;@/pages/DataBases/setting/topicManageNew/server&apos;;</span><br><span class="line"></span><br><span class="line">const IconFont = createFromIconfontCN(&#123;</span><br><span class="line">  scriptUrl: &apos;//at.alicdn.com/t/c/font_3573782_amwh7c9a9wd.js&apos;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export function useToggleVal(initial?: number) &#123;</span><br><span class="line">  const [_flag, _setFlag] = useState(initial)</span><br><span class="line">  const setFlag = useCallback(() =&gt; &#123;</span><br><span class="line">    _setFlag(prev =&gt; &#123;</span><br><span class="line">      return prev === 1 ? -1 : 1</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line">  return [_flag, setFlag]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const renderButStr = &#123;</span><br><span class="line">  &apos;icon-yidong&apos;: &apos;移动&apos;,</span><br><span class="line">  &apos;icon-caijian&apos;: &apos;裁剪&apos;,</span><br><span class="line">  &apos;icon-left-rotate&apos;: &apos;左旋转&apos;,</span><br><span class="line">  &apos;icon-right-rotate&apos;: &apos;右旋转&apos;,</span><br><span class="line">  &apos;icon-scaleX&apos;: &apos;水平翻转&apos;,</span><br><span class="line">  &apos;icon-scaleY&apos;: &apos;上下翻转&apos;,</span><br><span class="line">  &apos;icon-clear&apos;: &apos;清空&apos;,</span><br><span class="line">  &apos;icon-reset&apos;: &apos;复原&apos;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const CropperEditPic = (props) =&gt; &#123;</span><br><span class="line">  const &#123; cropperPic, cropperVisible, setCropperVisible, curRow, updateItem &#125; = props;</span><br><span class="line">  const [imgUrl, setImgUrl] = useState&lt;string&gt;(&apos;&apos;);</span><br><span class="line">  const [_flag, setFlag] = useToggleVal(-1)</span><br><span class="line">  const [_flag2, setFlag2] = useToggleVal(-1)</span><br><span class="line">  const cropperRef = useRef(null);</span><br><span class="line">  const inputVal = useRef(null);</span><br><span class="line"></span><br><span class="line">  // 渲染按钮</span><br><span class="line">  const renderButton = (onClick1: Function, onClick2: Function, name1: string, name2: string, tipname1: string, tipname2: string) =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&apos;buttonGroup&apos;&gt;</span><br><span class="line">        &lt;Tooltip title=&#123;renderButStr[tipname1]&#125;&gt;</span><br><span class="line">          &lt;Button onClick=&#123;onClick1&#125; &gt;&lt;IconFont type=&#123;name1&#125; /&gt;&lt;/Button&gt;</span><br><span class="line">        &lt;/Tooltip&gt;</span><br><span class="line">        &lt;Tooltip title=&#123;renderButStr[tipname2]&#125;&gt;</span><br><span class="line">          &lt;Button className=&#123;name1 === name2 ? &apos;rotation_inverted&apos; : &apos;&apos;&#125; onClick=&#123;onClick2&#125; &gt;&lt;IconFont type=&#123;name2&#125; /&gt;&lt;/Button&gt;</span><br><span class="line">        &lt;/Tooltip&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const handleOk = () =&gt; &#123;</span><br><span class="line">    setCropperVisible();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const handleCancel = () =&gt; &#123;</span><br><span class="line">    setCropperVisible();</span><br><span class="line">  &#125;;</span><br><span class="line">   </span><br><span class="line">  // 选择文件的打开事件</span><br><span class="line">  const handleChangeFile = (e) =&gt; &#123;</span><br><span class="line">    console.log(e)</span><br><span class="line">    const file = e.target.files[0];</span><br><span class="line">    const blobData = window.URL.createObjectURL(file);</span><br><span class="line">    // 构造临时的url地址</span><br><span class="line">    setImgUrl(blobData);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const moveClick = () =&gt; &#123;</span><br><span class="line">    cropperRef.current.cropper.setDragMode(&apos;move&apos;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const cropClick = () =&gt; &#123;</span><br><span class="line">    cropperRef.current.cropper.setDragMode(&apos;crop&apos;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const rotateClick = () =&gt; &#123;</span><br><span class="line">    cropperRef.current.cropper.rotate(45);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const rotateInvertedClick = () =&gt; &#123;</span><br><span class="line">    cropperRef.current.cropper.rotate(-45);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const transverseClick = () =&gt; &#123;</span><br><span class="line">    setFlag();</span><br><span class="line">    cropperRef.current.cropper.scaleX(_flag);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const verticalClick = () =&gt; &#123;</span><br><span class="line">    setFlag2();</span><br><span class="line">    cropperRef.current.cropper.scaleY(_flag2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const largeClick = () =&gt; &#123;</span><br><span class="line">    cropperRef.current.cropper.zoom(0.1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const smallClick = () =&gt; &#123;</span><br><span class="line">    cropperRef.current.cropper.zoom(-0.1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const resetClick = () =&gt; &#123;</span><br><span class="line">    cropperRef.current.cropper.reset();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const deleteClick = () =&gt; &#123;</span><br><span class="line">    cropperRef.current.cropper.clear()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* Uncaught DOMException: Failed to execute &apos;toDataURL&apos; on &apos;HTMLCanvasElement&apos;: Tainted canvases may not be exported.</span><br><span class="line">  canvas无法执行toDataURL方法：污染的画布无法输出，请原谅我的灵魂翻译。</span><br><span class="line">经google 发现原来是受限于 CORS 策略，会存在跨域问题，虽然可以使用图像（比如append到页面上）但是绘制到画布上会污染画布，</span><br><span class="line">一旦一个画布被污染, 就无法提取画布的数据，</span><br><span class="line">比如无法使用使用画布toBlob(), toDataURL(), 或getImageData()方法;当使用这些方法的时候 会抛出一个安全错误 */</span><br><span class="line">  const btnSubmit = () =&gt; &#123;</span><br><span class="line">    const params = &#123;</span><br><span class="line">      width: 160,</span><br><span class="line">      height: 90,</span><br><span class="line">      minWidth: 256,</span><br><span class="line">      minHeight: 256,</span><br><span class="line">      maxWidth: 4096,</span><br><span class="line">      maxHeight: 4096,</span><br><span class="line">      fillColor: &apos;#fff&apos;,</span><br><span class="line">      imageSmoothingEnabled: false,</span><br><span class="line">      imageSmoothingQuality: &apos;high&apos;,</span><br><span class="line">      // 设置图像平滑的质量，设置为“低”（默认）、“中等”或“高”之一。</span><br><span class="line">    &#125;</span><br><span class="line">    cropperRef.current.cropper.getCroppedCanvas(params).toBlob(blob =&gt; &#123;</span><br><span class="line">      return cropperPic(blob, updateItem)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // 将网络图片转换成base64格式</span><br><span class="line">  const transBase64FromImage = (image) =&gt; &#123;</span><br><span class="line">    let canvas = document.createElement(&quot;canvas&quot;);</span><br><span class="line">    canvas.width = image.width;</span><br><span class="line">    canvas.height = image.height;</span><br><span class="line">    let ctx = canvas.getContext(&quot;2d&quot;);</span><br><span class="line">    ctx &amp;&amp; ctx.drawImage(image, 0, 0, image.width, image.height);</span><br><span class="line">    // 可选其他值 image/jpeg</span><br><span class="line">    return canvas.toDataURL(&quot;image/jpeg&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // 设置打开窗口显示的裁剪图片</span><br><span class="line">    if (curRow !== &apos;&apos;) &#123;</span><br><span class="line">      setImgUrl(curRow);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [curRow])</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;Modal</span><br><span class="line">        maskClosable=&#123;false&#125;</span><br><span class="line">        className=&apos;CropperEditPicModal&apos;</span><br><span class="line">        style=&#123;&#123; minHeight: &apos;50vh&apos; &#125;&#125;</span><br><span class="line">        width=&#123;&apos;50vw&apos;&#125;</span><br><span class="line">        closeIcon=&#123;&lt;img src=&#123;closePic&#125; width=&#123;29&#125; height=&#123;29&#125; /&gt;&#125;</span><br><span class="line">        title=&#123;&apos;图片剪裁&apos;&#125;</span><br><span class="line">        visible=&#123;cropperVisible&#125;</span><br><span class="line">        onOk=&#123;handleOk&#125;</span><br><span class="line">        footer=&#123;null&#125;</span><br><span class="line">        onCancel=&#123;handleCancel&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;div className=&quot;s-upload-main&quot;&gt;</span><br><span class="line">          &lt;div className=&quot;top-box&quot;&gt;</span><br><span class="line">            &lt;div className=&quot;btn file-box&quot;&gt;</span><br><span class="line">              &lt;span&gt;选择文件...&lt;/span&gt;&lt;input</span><br><span class="line">                ref=&#123;inputVal&#125;</span><br><span class="line">                id=&quot;file&quot;</span><br><span class="line">                type=&quot;file&quot;</span><br><span class="line">                name=&quot;singlePhoto&quot;</span><br><span class="line">                accept=&quot;image/*&quot;</span><br><span class="line">                className=&quot;btn&quot;</span><br><span class="line">                onChange=&#123;handleChangeFile&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &#123;renderButton(moveClick, cropClick, &apos;icon-yidong&apos;, &apos;icon-caijian&apos;, &apos;icon-yidong&apos;, &apos;icon-caijian&apos;)&#125;</span><br><span class="line">            &#123;renderButton(rotateClick, rotateInvertedClick, &apos;icon-icon_rotate&apos;, &apos;icon-icon_rotate&apos;, &apos;icon-left-rotate&apos;, &apos;icon-right-rotate&apos;)&#125;</span><br><span class="line">            &#123;renderButton(transverseClick, verticalClick, &apos;icon-link-arrow-h-full&apos;, &apos;icon-link-arrow-v-full&apos;, &apos;icon-scaleX&apos;, &apos;icon-scaleY&apos;)&#125;</span><br><span class="line">            &#123;renderButton(deleteClick, resetClick, &apos;icon-quxiao&apos;, &apos;icon-icon-refresh&apos;, &apos;icon-clear&apos;, &apos;icon-reset&apos;)&#125;</span><br><span class="line">            </span><br><span class="line">            &lt;Button className=&apos;preservation&apos; onClick=&#123;btnSubmit&#125;&gt;保存&lt;/Button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div className=&quot;s-upload-content&quot;&gt;</span><br><span class="line">            &lt;div className=&quot;left-box&quot;&gt;</span><br><span class="line">              &lt;Cropper</span><br><span class="line">                style=&#123;&#123;</span><br><span class="line">                  height: 400</span><br><span class="line">                &#125;&#125;</span><br><span class="line">                // cropper对象注意设置checkCrossOrigin和checkOrientation两个属性，就能跨域访问了</span><br><span class="line">                // checkOrientation=&#123;false&#125;</span><br><span class="line">                // checkCrossOrigin=&#123;false&#125;</span><br><span class="line">                src=&#123;imgUrl&#125;</span><br><span class="line">                // 元素或元素数组或节点列表对象或 Document.querySelector 的所有有效选择器</span><br><span class="line">                preview=&#123;&apos;.previewBox&apos;&#125;</span><br><span class="line">                ref=&#123;cropperRef&#125;</span><br><span class="line">                initialAspectRatio=&#123;1&#125; //定义裁剪框的初始宽高比</span><br><span class="line">                viewMode=&#123;0&#125; //裁剪框不能超过画布大小</span><br><span class="line">                guides=&#123;true&#125; //网格线</span><br><span class="line">                minCropBoxHeight=&#123;10&#125; //最小高度</span><br><span class="line">                minCropBoxWidth=&#123;10&#125;</span><br><span class="line">                background=&#123;false&#125;</span><br><span class="line">                movable=&#123;true&#125;</span><br><span class="line">                cropBoxMovable=&#123;true&#125; //裁剪框是否移动</span><br><span class="line">                cropBoxResizable=&#123;true&#125; //裁剪框大小是否变化</span><br><span class="line">                scalable=&#123;true&#125;  //是否可以放大</span><br><span class="line">                rotatable=&#123;true&#125; //是否可以旋转</span><br><span class="line">                dragMode=&#123;&apos;move&apos;&#125; //单击设置为移动图片</span><br><span class="line">                //这个比较重要，单击时，设置裁剪框不可变化</span><br><span class="line">                toggleDragModeOnDblclick=&#123;false&#125;</span><br><span class="line">                //这个也比较重要，对于有方向值的图片是否根据方向值旋转</span><br><span class="line">                checkOrientation=&#123;false&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div className=&quot;right-box&quot;&gt;</span><br><span class="line">              &#123;/* preview=&#123;&apos;.previewBox&apos;&#125;设置右侧预览的图片，对应的是dom元素 */&#125;</span><br><span class="line">              &lt;div className=&quot;previewBox&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/Modal&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default React.memo(CropperEditPic);</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 图片裁剪的样式文件 */</span></span><br><span class="line"><span class="selector-class">.CropperEditPicModal</span> &#123;</span><br><span class="line">  .ant-modal-body &#123;</span><br><span class="line">    <span class="selector-tag">padding</span>: 0 !<span class="selector-tag">important</span>;</span><br><span class="line">    <span class="selector-tag">padding-top</span>: 23<span class="selector-tag">px</span> !<span class="selector-tag">important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.ant-modal-header</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">0</span> <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#2a82e4</span> <span class="meta">!important</span>;</span><br><span class="line"></span><br><span class="line">    .ant-modal-title &#123;</span><br><span class="line">      <span class="selector-tag">color</span>: <span class="selector-id">#fff</span> !<span class="selector-tag">important</span>;</span><br><span class="line">      <span class="selector-tag">font-weight</span>: <span class="selector-tag">bold</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.ant-modal-content</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">0</span> <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.CropperBox</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">700px</span>;</span><br><span class="line"></span><br><span class="line">    .CropperBoxHeader &#123;</span><br><span class="line">      <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span><br><span class="line">      <span class="selector-tag">height</span>: 60<span class="selector-tag">px</span>;</span><br><span class="line">      <span class="selector-tag">text-align</span>: <span class="selector-tag">center</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.CropperBoxContent</span> &#123;</span><br><span class="line">      <span class="attribute">justify-content</span>: center;</span><br><span class="line">      <span class="attribute">align-items</span>: center;</span><br><span class="line">      <span class="attribute">display</span>: flex;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">92%</span>;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="number">#e9f2fc</span>;</span><br><span class="line"></span><br><span class="line">      .xi-cropper-wrap &#123;</span><br><span class="line">        <span class="selector-tag">width</span>: 660<span class="selector-tag">px</span> !<span class="selector-tag">important</span>;</span><br><span class="line">        <span class="selector-tag">height</span>: 400<span class="selector-tag">px</span> !<span class="selector-tag">important</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.xi-cropper-upload</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">660px</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">400px</span> <span class="meta">!important</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-tag">input</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">660px</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">400px</span> <span class="meta">!important</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.xi-cropper-file</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">660px</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">400px</span> <span class="meta">!important</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.chooseBtn</span> &#123;</span><br><span class="line">      <span class="attribute">margin-bottom</span>: <span class="number">30px</span>;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="number">#5ebc5e</span>;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">5vw</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">42px</span>;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="number">17px</span>;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#5ebc5e</span>;</span><br><span class="line">      <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">      <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* cropper主体 */</span></span><br><span class="line">  <span class="selector-class">.s-upload-main</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line"></span><br><span class="line">    .top-box &#123;</span><br><span class="line">      <span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br><span class="line">      <span class="selector-tag">margin-bottom</span>: 18<span class="selector-tag">px</span>;</span><br><span class="line">      <span class="selector-tag">display</span>: <span class="selector-tag">flex</span>;</span><br><span class="line">      <span class="selector-tag">justify-content</span>: <span class="selector-tag">center</span>;</span><br><span class="line">      <span class="selector-tag">align-items</span>: <span class="selector-tag">center</span>;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.file-box</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">        <span class="attribute">overflow</span>: hidden;</span><br><span class="line">        <span class="attribute">background</span>: <span class="number">#eca054</span>;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line"></span><br><span class="line">        span &#123;</span><br><span class="line">          <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span><br><span class="line">          <span class="selector-tag">padding</span>: 0 10<span class="selector-tag">px</span>;</span><br><span class="line">          <span class="selector-tag">display</span>: <span class="selector-tag">block</span>;</span><br><span class="line">          <span class="selector-tag">height</span>: 40<span class="selector-tag">px</span>;</span><br><span class="line">          <span class="selector-tag">line-height</span>: 40<span class="selector-tag">px</span>;</span><br><span class="line">          <span class="selector-tag">font-size</span>: 18<span class="selector-tag">px</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.btn</span> &#123;</span><br><span class="line">          <span class="attribute">position</span>: absolute;</span><br><span class="line">          <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">          <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">          <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">          <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">          <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">          <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">          <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.buttonGroup</span> &#123;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">        <span class="attribute">overflow</span>: hidden;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        .ant-btn&#123;</span><br><span class="line">          <span class="selector-tag">border-radius</span>: 0;</span><br><span class="line">          <span class="selector-tag">border</span>: <span class="selector-tag">none</span> !<span class="selector-tag">important</span>;</span><br><span class="line">          <span class="selector-tag">height</span>: 40<span class="selector-tag">px</span>;</span><br><span class="line">          <span class="selector-tag">padding</span>: 0 15<span class="selector-tag">px</span>;</span><br><span class="line">          <span class="selector-tag">background</span>: <span class="selector-id">#2a82e4</span>;</span><br><span class="line">          <span class="selector-tag">display</span>: <span class="selector-tag">flex</span>;</span><br><span class="line">          <span class="selector-tag">align-items</span>: <span class="selector-tag">center</span>;</span><br><span class="line">          &amp;<span class="selector-class">.rotation_inverted</span>&#123;</span><br><span class="line">            svg&#123;</span><br><span class="line">              <span class="selector-tag">transform</span>: <span class="selector-tag">scaleX</span>(<span class="selector-tag">-1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          &amp;<span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">            <span class="attribute">background</span>: <span class="number">#2a82e4</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="selector-tag">span</span>&#123;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.preservation</span> &#123;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">        <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">        <span class="attribute">width</span>: auto;</span><br><span class="line">        <span class="attribute">border</span>: none;</span><br><span class="line">        <span class="attribute">background</span>: <span class="number">#28A745</span>;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.s-upload-content</span> &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">      <span class="attribute">display</span>: flex;</span><br><span class="line">      <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">      <span class="attribute">overflow</span>: hidden;</span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">rgba</span>(233, 242, 252, 1);</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">30px</span>;</span><br><span class="line"></span><br><span class="line">      .left-box &#123;</span><br><span class="line">        <span class="selector-tag">float</span>: <span class="selector-tag">left</span>;</span><br><span class="line">        <span class="selector-tag">width</span>: 66%;</span><br><span class="line">        <span class="selector-tag">height</span>: 520<span class="selector-tag">px</span>;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.image</span> &#123;</span><br><span class="line">          <span class="attribute">display</span>: block;</span><br><span class="line">          <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">          <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.right-box</span> &#123;</span><br><span class="line">        <span class="attribute">float</span>: right;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">        <span class="attribute">background</span>: <span class="number">#ececec</span>;</span><br><span class="line"></span><br><span class="line">        .previewBox &#123;</span><br><span class="line">          <span class="selector-tag">width</span>: 250<span class="selector-tag">px</span>;</span><br><span class="line">          <span class="selector-tag">height</span>: 250<span class="selector-tag">px</span>;</span><br><span class="line">          <span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br><span class="line">          <span class="comment">/* 这个属性可以得到想要的效果 */</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-pseudo">:gabel</span> &#123;</span><br><span class="line">    .xi-cropper-modal &#123;</span><br><span class="line">      <span class="selector-tag">position</span>: <span class="selector-tag">relative</span>;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.xi-cropper-modalMask</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.xi-cropper-modal</span> <span class="selector-class">.cropper-modal-content</span> &#123;</span><br><span class="line">    // top: 360px !important;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.xi-cropper-modal</span> <span class="selector-class">.cropper-modal-content</span> <span class="selector-class">.cropper-modal-header</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这个插件的几个重要属性：&lt;Cropper<br>                src={imgUrl}<br>               // 元素或元素数组或节点列表对象或 Document.querySelector 的所有有效选择器<br>                preview={‘.previewBox’} /&gt;</p>
<p>   这个【src是展示的图片地址】，如果是跨域访问的图片地址，他是展示不出来的，就算设置了跨域访问，保存也是保存不了的，他会提示有污染的画布。注意这点！！！！</p>
<p>这个【preview是预览的dom元素】</p>
<p>详细的属性介绍可以参考插件的网址。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> const blobToFile = (blob, fileName) =&gt; &#123;</span><br><span class="line">    return new window.File([blob], fileName, &#123;</span><br><span class="line">      type: blob.type</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">// 父组件裁剪图片的方法</span><br><span class="line">  const cropperPic = (blob, updateItem) =&gt; &#123;</span><br><span class="line">    const formData = new FormData();</span><br><span class="line">    // Pass the image file name as the third parameter if necessary.</span><br><span class="line">    const newfile = blobToFile(blob, &apos;pic.png&apos;)</span><br><span class="line">    // 要把blob转成file对象，同时要给文件的后缀名，接口要求！！</span><br><span class="line">    //向 FormData 中添加新的属性值，FormData 对应的属性值存在也不会覆盖原值，而是新增一个值，如果属性不存在则新增一项属性值。</span><br><span class="line">    formData.append(&apos;file&apos;, newfile);</span><br><span class="line"></span><br><span class="line">    uploadImage(formData).then(res =&gt; &#123;</span><br><span class="line">      if (res.code === 200) &#123;</span><br><span class="line">        const updateParams = &#123;</span><br><span class="line">          ...updateItem,</span><br><span class="line">          fmLink: res.data.fmLink,</span><br><span class="line">          fsLink: res.data.fsLink,</span><br><span class="line">          f_Link: res.data.f_Link,</span><br><span class="line">        &#125;</span><br><span class="line">        editDocById([updateParams]).then((res) =&gt; &#123;</span><br><span class="line">          if (res.code !== 200) return message.error(&apos;上传图片失败&apos;);</span><br><span class="line">          message.success(&apos;上传图片成功&apos;);</span><br><span class="line">          setCropperVisible(false);</span><br><span class="line">          handleSearch();</span><br><span class="line">        &#125;).catch(err =&gt; &#123;</span><br><span class="line">          return message.error(&apos;上传图片失败&apos;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return message.erlibraryListror(res.message || &apos;上传图片失败&apos;, 10);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).catch(err =&gt; &#123;</span><br><span class="line">      return message.error(&apos;上传图片失败&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .....</span><br><span class="line">return (</span><br><span class="line">   &#123;</span><br><span class="line">        cropperVisible &amp;&amp;</span><br><span class="line">        &lt;CropperEditPic</span><br><span class="line">          cropperPic=&#123;cropperPic&#125;</span><br><span class="line">          setCropperVisible=&#123;setCropperVisible&#125;</span><br><span class="line">          cropperVisible=&#123;cropperVisible&#125;</span><br><span class="line">          curRow=&#123;cropperCurRowUrl&#125;</span><br><span class="line">          updateItem=&#123;cropperItem&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>参考资料：</p>
<p><a href="https://fengyuanchen.github.io/cropperjs/" target="_blank" rel="noopener">https://fengyuanchen.github.io/cropperjs/</a><br><a href="https://github.com/fengyuanchen/cropperjs/blob/main/README.md" target="_blank" rel="noopener">https://github.com/fengyuanchen/cropperjs/blob/main/README.md</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2022/06/01/antd的表单动态增加/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2022/06/01/antd的表单动态增加/" class="post-title-link" itemprop="url">antd的表单动态增加</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2022-06-01 15:08:28" itemprop="dateCreated datePublished" datetime="2022-06-01T15:08:28+08:00">2022-06-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2022-06-18 23:30:18" itemprop="dateModified" datetime="2022-06-18T23:30:18+08:00">2022-06-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/antd/" itemprop="url" rel="index"><span itemprop="name">antd</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>该文介绍我在项目中遇到的动态增加表单问题</strong></p>
<blockquote>
<p>首先贴一段代码</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Card &#125; from &apos;antd&apos;;</span><br><span class="line">import React, &#123; useState, useCallback &#125; from &apos;react&apos;</span><br><span class="line">import &#123; MinusCircleOutlined, PlusOutlined &#125; from &apos;@ant-design/icons&apos;;</span><br><span class="line">import &#123; Button, Form, Input, Select, Space &#125; from &apos;antd&apos;;</span><br><span class="line"></span><br><span class="line">const &#123; Option &#125; = Select;</span><br><span class="line"></span><br><span class="line">const areas = [</span><br><span class="line">  &#123; label: &apos;Beijing&apos;, value: &apos;Beijing&apos; &#125;,</span><br><span class="line">  &#123; label: &apos;Shanghai&apos;, value: &apos;Shanghai&apos; &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">const containers = [</span><br><span class="line">  &#123; label: &apos;包含&apos;, value: &apos;Y&apos; &#125;,</span><br><span class="line">  &#123; label: &apos;不包含&apos;, value: &apos;N&apos; &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">const sights = &#123;</span><br><span class="line">  Beijing: [&apos;Tiananmen&apos;, &apos;Great Wall&apos;],</span><br><span class="line">  Shanghai: [&apos;Oriental Pearl&apos;, &apos;The Bund&apos;],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type sightsKeys = keyof typeof sights;</span><br><span class="line"></span><br><span class="line">interface yearobj &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  zt_year: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const addForm = () =&gt; &#123;</span><br><span class="line">  const [ztlist, setZtlist] = useState&lt;yearobj[]&gt;([])</span><br><span class="line">  const [monthList, setMonthList] = useState([])</span><br><span class="line">  const [form] = Form.useForm();</span><br><span class="line"></span><br><span class="line">  const onFinish = (values: any) =&gt; &#123;</span><br><span class="line">    console.log(&apos;Received values of form:&apos;, values);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const handleChange = () =&gt; &#123;</span><br><span class="line">    form.setFieldsValue(&#123; sights: [] &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // 展开专题年份的下拉框</span><br><span class="line">  const handleOpenSelect = (open) =&gt; &#123;</span><br><span class="line">    if (open) &#123;</span><br><span class="line">      const yearsArr = [</span><br><span class="line">        &#123; id: 1, zt_year: &apos;2017&apos; &#125;,</span><br><span class="line">        &#123; id: 2, zt_year: &apos;2018&apos; &#125;,</span><br><span class="line">        &#123; id: 3, zt_year: &apos;2019&apos; &#125;,</span><br><span class="line">        &#123; id: 4, zt_year: &apos;2020&apos; &#125;</span><br><span class="line">      ]</span><br><span class="line">      setZtlist(yearsArr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 年份字段值发生改变</span><br><span class="line">  const handleSelectChange = useCallback(</span><br><span class="line">    (index) =&gt; &#123;</span><br><span class="line">      console.log(&apos;选择年份...&apos;)</span><br><span class="line">      const monthArr = [</span><br><span class="line">        &#123; id: 1, month: &apos;一月&apos; &#125;,</span><br><span class="line">        &#123; id: 2, month: &apos;二月&apos; &#125;,</span><br><span class="line">        &#123; id: 3, month: &apos;三月&apos; &#125;,</span><br><span class="line">        &#123; id: 4, month: &apos;四月&apos; &#125;</span><br><span class="line">      ]</span><br><span class="line">      setMonthList(monthArr);</span><br><span class="line">    &#125;, []</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  // 处理点击加号，新增</span><br><span class="line">  const handleClickAdd = async (add, fields) =&gt; &#123;</span><br><span class="line">    console.log(&apos;addd.....&apos;)</span><br><span class="line">    console.log(form.getFieldsValue())</span><br><span class="line">    // console.log(form.getFieldValue(&apos;sights&apos;));</span><br><span class="line">    // console.log(form.getFieldValue(&apos;sights&apos;).length);</span><br><span class="line">    // 这里的下一个元素是undefined，要赋值为最新的</span><br><span class="line">    // const oldArr = [...form.getFieldValue(&apos;sights&apos;)];</span><br><span class="line">    // console.log(oldArr)</span><br><span class="line">    // 这是最新添加的表单项的值</span><br><span class="line">    // const newsObj = form.getFieldValue(&apos;sights&apos;)[form.getFieldValue(&apos;sights&apos;).length - 1]</span><br><span class="line">    // console.log(newsObj)</span><br><span class="line">    // 触发表单校验</span><br><span class="line">    const fieldsValue = await form.validateFields();</span><br><span class="line">    console.log(fieldsValue);</span><br><span class="line">    add(&#123;</span><br><span class="line">      names: &apos;我是默认的名字&apos;,</span><br><span class="line">      contain: &quot;Y&quot;</span><br><span class="line">    &#125;, 0)</span><br><span class="line">    // add: (defaultValue?: StoreValue, insertIndex?: number) =&gt; void;</span><br><span class="line">    // 源码中：第一个对象是默认值，后面是插入的位置，我这里是0就每次都插在第一个</span><br><span class="line">    /* add(&#123;</span><br><span class="line">      // subjectName: newsObj.subjectName || fieldsValue.sights[0].subjectName,</span><br><span class="line">      category: newsObj.category || fieldsValue.sights[0].category,</span><br><span class="line">      subjectYear: newsObj.subjectYear || fieldsValue.sights[0].subjectYear,</span><br><span class="line">    &#125;); */</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Form</span><br><span class="line">      initialValues=&#123;&#123;</span><br><span class="line">        keywordsOne: &#123; contain: &apos;Y&apos;, keywords: &apos;默认的关键词&apos; &#125;</span><br><span class="line">      &#125;&#125;</span><br><span class="line">      form=&#123;form&#125;</span><br><span class="line">      name=&quot;dynamic_form_nest_item&quot;</span><br><span class="line">      onFinish=&#123;onFinish&#125;</span><br><span class="line">      autoComplete=&quot;off&quot;&gt;</span><br><span class="line">      &lt;Form.Item</span><br><span class="line">        label=&#123;&apos;订阅夹名称&apos;&#125;</span><br><span class="line">        name=&quot;subname&quot;</span><br><span class="line">        rules=&#123;[</span><br><span class="line">          &#123; required: true, message: &apos;请输入订阅夹名称!&apos; &#125;,</span><br><span class="line">          /* &#123; max: 6, message: &apos;订阅夹名称长度不超过6&apos; &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            message: &apos;只能输入中文字符&apos;,</span><br><span class="line">            pattern: /^[\u4e00-\u9fa5]+$/i,</span><br><span class="line">            // 限制只能输入中文</span><br><span class="line">          &#125;, */</span><br><span class="line">          &#123;</span><br><span class="line">            validator: function (rule, value, callback) &#123;</span><br><span class="line">              try &#123;</span><br><span class="line">                if (value &amp;&amp; value.length &gt; 6) &#123;</span><br><span class="line">                  throw new Error(&apos;订阅夹名称长度不超过6&apos;);</span><br><span class="line">                &#125;</span><br><span class="line">                // 因为自定义校验规则都会走到这里，我们不输入值的话会进行判断中文字符刚好他也符合</span><br><span class="line">                // 就会弹出两个提示，所以这里做个判断直接callback</span><br><span class="line">                if (!value) &#123;</span><br><span class="line">                  console.log(&apos;进入了&apos;);</span><br><span class="line">                  callback();</span><br><span class="line">                &#125;</span><br><span class="line">                if (!(/^[\u4E00-\u9FA5]+$/.test(value))) &#123;</span><br><span class="line">                  throw new Error(&apos;只能输入中文字符&apos;);</span><br><span class="line">                &#125;</span><br><span class="line">                callback();</span><br><span class="line">              &#125; catch (err) &#123;</span><br><span class="line">                callback(err);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;Input style=&#123;&#123; width: &apos;14vw&apos; &#125;&#125; className=&apos;subNameClass&apos; placeholder=&apos;请输入订阅夹名称&apos; /&gt;</span><br><span class="line">      &lt;/Form.Item&gt;</span><br><span class="line">      &lt;Form.Item label=&quot;第一行的关键词&quot;&gt;</span><br><span class="line">        &lt;Input.Group compact&gt;</span><br><span class="line">          &lt;Form.Item</span><br><span class="line">            style=&#123;&#123; marginRight: &apos;20px&apos; &#125;&#125;</span><br><span class="line">            name=&#123;[&apos;keywordsOne&apos;, &apos;contain&apos;]&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;Select placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">              &lt;Option value=&quot;Y&quot;&gt;包含&lt;/Option&gt;</span><br><span class="line">              &lt;Option value=&quot;N&quot;&gt;不包含&lt;/Option&gt;</span><br><span class="line">            &lt;/Select&gt;</span><br><span class="line">          &lt;/Form.Item&gt;</span><br><span class="line">          &lt;Form.Item</span><br><span class="line">            name=&#123;[&apos;keywordsOne&apos;, &apos;keywords&apos;]&#125;</span><br><span class="line">            noStyle</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;Input style=&#123;&#123; width: &apos;14vw&apos; &#125;&#125; placeholder=&quot;请输入关键词&quot; /&gt;</span><br><span class="line">          &lt;/Form.Item&gt;</span><br><span class="line">        &lt;/Input.Group&gt;</span><br><span class="line">      &lt;/Form.Item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Form.List name=&quot;sights&quot;&gt;</span><br><span class="line">        &#123;/* Form.List 下的字段需要包裹 Form.List 本身的 nam */&#125;</span><br><span class="line">        &#123;(fields, &#123; add, remove &#125;) =&gt; (</span><br><span class="line">          &lt;&gt;</span><br><span class="line">            &#123;fields.map((field, index) =&gt; (</span><br><span class="line">              &lt;Space key=&#123;field.key&#125; align=&quot;baseline&quot;&gt;</span><br><span class="line">                &lt;Form.Item &#123;...field&#125; name=&#123;[field.name, &apos;subjectYear&apos;]&#125; label=&quot;专题年份&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                  &lt;Select placeholder=&quot;请选择年份&quot; onDropdownVisibleChange=&#123;handleOpenSelect&#125; onChange=&#123;() =&gt; handleSelectChange(index)&#125;&gt;</span><br><span class="line">                    &#123;ztlist.map((item) =&gt; &#123;</span><br><span class="line">                      return (</span><br><span class="line">                        &lt;Option value=&#123;item.zt_year&#125; key=&#123;item.zt_year&#125;&gt;</span><br><span class="line">                          &#123;item.zt_year&#125;</span><br><span class="line">                        &lt;/Option&gt;</span><br><span class="line">                      );</span><br><span class="line">                    &#125;)&#125;</span><br><span class="line">                  &lt;/Select&gt;</span><br><span class="line">                &lt;/Form.Item&gt;</span><br><span class="line">                &lt;Form.Item</span><br><span class="line">                  noStyle</span><br><span class="line">                  shouldUpdate=&#123;(prevValues, curValues) =&gt;</span><br><span class="line">                    prevValues.area !== curValues.area || prevValues.sights !== curValues.sights</span><br><span class="line">                  &#125;</span><br><span class="line">                &gt;</span><br><span class="line">                  &#123;() =&gt; (</span><br><span class="line">                    &lt;Form.Item</span><br><span class="line">                      &#123;...field&#125;</span><br><span class="line">                      label=&quot;包含类型&quot;</span><br><span class="line">                      name=&#123;[field.name, &apos;contain&apos;]&#125;</span><br><span class="line">                      rules=&#123;[&#123; required: true, message: &apos;必须选择其中一项&apos; &#125;]&#125;</span><br><span class="line">                    &gt;</span><br><span class="line">                      &#123;/* disabled=&#123;!form.getFieldValue(&apos;area&apos;)&#125; */&#125;</span><br><span class="line">                      &lt;Select style=&#123;&#123; width: &quot;10vw&quot; &#125;&#125;&gt;</span><br><span class="line">                        &#123;(/* sights[form.getFieldValue(&apos;area&apos;) as sightsKeys] */containers || []).map(item =&gt; (</span><br><span class="line">                          &lt;Option key=&#123;item&#125; value=&#123;item.value&#125;&gt;</span><br><span class="line">                            &#123;item.label&#125;</span><br><span class="line">                          &lt;/Option&gt;</span><br><span class="line">                        ))&#125;</span><br><span class="line">                      &lt;/Select&gt;</span><br><span class="line">                    &lt;/Form.Item&gt;</span><br><span class="line">                  )&#125;</span><br><span class="line">                &lt;/Form.Item&gt;</span><br><span class="line">                &lt;Form.Item</span><br><span class="line">                  &#123;...field&#125;</span><br><span class="line">                  label=&quot;月份&quot;</span><br><span class="line">                  name=&#123;[field.name, &apos;month&apos;]&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                  &lt;Select style=&#123;&#123; width: &apos;5vw&apos; &#125;&#125;&gt;</span><br><span class="line">                    &#123;monthList.map((item) =&gt; &#123;</span><br><span class="line">                      return (</span><br><span class="line">                        &lt;Option value=&#123;item.month&#125; key=&#123;item.month&#125;&gt;</span><br><span class="line">                          &#123;item.month&#125;</span><br><span class="line">                        &lt;/Option&gt;</span><br><span class="line">                      );</span><br><span class="line">                    &#125;)&#125;</span><br><span class="line">                  &lt;/Select&gt;</span><br><span class="line">                &lt;/Form.Item&gt;</span><br><span class="line">                &lt;Form.Item</span><br><span class="line">                  &#123;...field&#125;</span><br><span class="line">                  label=&quot;关键词&quot;</span><br><span class="line">                  name=&#123;[field.name, &apos;keywords&apos;]&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                  &lt;Input placeholder=&apos;请输入关键词，多个以逗号分割开~&apos; style=&#123;&#123; width: &quot;15vw&quot; &#125;&#125; /&gt;</span><br><span class="line">                &lt;/Form.Item&gt;</span><br><span class="line"></span><br><span class="line">                &lt;Form.Item</span><br><span class="line">                  &#123;...field&#125;</span><br><span class="line">                  label=&apos;姓名&apos;</span><br><span class="line">                  name=&#123;[field.name, &apos;names&apos;]&#125;</span><br><span class="line">                  validateTrigger=&#123;[&apos;onChange&apos;, &apos;onBlur&apos;]&#125;</span><br><span class="line">                  rules=&#123;[</span><br><span class="line">                    &#123;</span><br><span class="line">                      required: true,</span><br><span class="line">                      whitespace: true,</span><br><span class="line">                      message: &quot;Please input passenger&apos;s name or delete this field.&quot;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ]&#125;</span><br><span class="line">                  noStyle</span><br><span class="line">                &gt;</span><br><span class="line">                  &lt;Input placeholder=&quot;passenger name&quot; style=&#123;&#123; width: &apos;15vw&apos; &#125;&#125; /&gt;</span><br><span class="line">                &lt;/Form.Item&gt;</span><br><span class="line"></span><br><span class="line">                &lt;MinusCircleOutlined onClick=&#123;() =&gt; remove(field.name)&#125; /&gt;</span><br><span class="line">              &lt;/Space&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line"></span><br><span class="line">            &lt;Form.Item&gt;</span><br><span class="line">              &lt;Button style=&#123;&#123; width: &quot;20vw&quot;, backgroundColor: &apos;grey&apos;, color: &apos;#fff&apos; &#125;&#125; type=&quot;dashed&quot;</span><br><span class="line">                onClick=&#123;() =&gt; handleClickAdd(add, fields)&#125;</span><br><span class="line">                block icon=&#123;&lt;PlusOutlined /&gt;&#125;&gt;</span><br><span class="line">                【添加新的表单项】</span><br><span class="line">              &lt;/Button&gt;</span><br><span class="line">            &lt;/Form.Item&gt;</span><br><span class="line">          &lt;/&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      &lt;/Form.List&gt;</span><br><span class="line">      &lt;Form.Item &gt;</span><br><span class="line">        &lt;Button type=&quot;primary&quot; htmlType=&quot;submit&quot;&gt;</span><br><span class="line">          Submit</span><br><span class="line">        &lt;/Button&gt;</span><br><span class="line">      &lt;/Form.Item&gt;</span><br><span class="line">    &lt;/Form&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default React.memo(addForm)</span><br></pre></td></tr></table></figure>
<p><img src="../images/antd_form_1.png" alt></p>
<blockquote>
<p>这里说几个要注意的点：<br>1、form表单如果<strong>想要初始化表单值</strong>的话有两种方法，【默认值可以用 Form 里的 <code>initialValues</code> 来设置。注意 <code>initialValues</code> 不能被 <code>setState</code> 动态更新，你需要用 <code>setFieldsValue</code> 来更新。】①&lt;Form</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;    initialValues=&#123;&#123;</span><br><span class="line">&gt;         keywordsOne: &#123; <span class="attr">contain</span>: <span class="string">'Y'</span>, <span class="attr">keywords</span>: <span class="string">'默认的关键词'</span> &#125;</span><br><span class="line">&gt;       &#125;&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>②就是使用form.setFieldsValue回显数据动态表单项</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;    form.setFieldsValue(&#123;</span><br><span class="line">&gt; 		addformItems: restArr    &#125;)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>2、如果对Input<strong>进行自定义校验</strong>的话有以下需要注意的地方：<br> <strong>pattern: /^[\u4e00-\u9fa5]+$/i</strong>, 【 限制只能输入中文】但是这样可能会出现必填和中文的提示占两行。<br><strong>注：</strong>这时候可以把长度判断和中文判断放到自定义校验里面，因为他先走了必填的校验，然后会接着走到自定义校验，然后这个时候value是没有值的，然后判断到空格也不是中文，所以也会出现必填和中文的提示占两行。这个时候可以判断如果他没值的话就直接callback()就不会走到下一个判断。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&gt;  rules=&#123;[</span><br><span class="line">&gt;           &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'请输入订阅夹名称!'</span> &#125;,</span><br><span class="line">&gt;           <span class="comment">/* &#123; max: 6, message: '订阅夹名称长度不超过6' &#125;,</span></span><br><span class="line"><span class="comment">&gt;           &#123;</span></span><br><span class="line"><span class="comment">&gt;             message: '只能输入中文字符',</span></span><br><span class="line"><span class="comment">&gt;             pattern: /^[\u4e00-\u9fa5]+$/i,</span></span><br><span class="line"><span class="comment">&gt;             // 限制只能输入中文</span></span><br><span class="line"><span class="comment">&gt;           &#125;, */</span></span><br><span class="line">&gt;           &#123;</span><br><span class="line">&gt;             validator: <span class="function"><span class="keyword">function</span> (<span class="params">rule, value, callback</span>) </span>&#123;</span><br><span class="line">&gt;               <span class="keyword">try</span> &#123;</span><br><span class="line">&gt;                 <span class="keyword">if</span> (value &amp;&amp; value.length &gt; <span class="number">6</span>) &#123;</span><br><span class="line">&gt;                   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'订阅夹名称长度不超过6'</span>);</span><br><span class="line">&gt;                 &#125;</span><br><span class="line">&gt;            <span class="comment">// **因为自定义校验规则都会走到这里，我们不输入值的话会进行判断中文字符刚好他也符合**</span></span><br><span class="line">&gt;                 <span class="comment">// **就会弹出两个提示，所以这里做个判断直接callback**</span></span><br><span class="line">&gt;                 <span class="keyword">if</span> (!value) &#123;</span><br><span class="line">&gt;                   <span class="built_in">console</span>.log(<span class="string">'进入了'</span>);</span><br><span class="line">&gt;                   callback();</span><br><span class="line">&gt;                 &#125;</span><br><span class="line">&gt;                 <span class="keyword">if</span> (!(<span class="regexp">/^[\u4E00-\u9FA5]+$/</span>.test(value))) &#123;</span><br><span class="line">&gt;                   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'只能输入中文字符'</span>);</span><br><span class="line">&gt;                 &#125;</span><br><span class="line">&gt;                 callback(); <span class="comment">// 必须要callback()的</span></span><br><span class="line">&gt;               &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">&gt;                 callback(err);</span><br><span class="line">&gt;               &#125;</span><br><span class="line">&gt;             &#125;</span><br><span class="line">&gt;           &#125;</span><br><span class="line">&gt;         ]&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>3、每个form的item的Label对应的是表单项前面的<strong>文字会自动为你补上文字加冒号</strong>。例如：  </p>
<p>&lt;Form.Item label=”第一行的关键词”&gt;</p>
<p>4、因为这个代码，我们把所有的代码都放到了一个表单form，所有只有我们<strong>第一行的输入框校验通过，才可以进行add动态的表单项</strong>，如果是非必填的话也可以进行add动态表单项，或者不要把第一行的输入框放入form表单里。需要注意这个！！！</p>
<p>5、接下来是动态添加动态表单项的问题：<br>这里我做了一个显示的判断，只有当我们的专题年份选择有值的时候，月份下拉框才显示有值，这里一般是通过请求数据后set值的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">const</span> handleSelectChange = useCallback(</span><br><span class="line">&gt;     <span class="function">(<span class="params">index</span>) =&gt;</span> &#123;</span><br><span class="line">&gt;      <span class="keyword">const</span> monthArr = [</span><br><span class="line">&gt;         &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">month</span>: <span class="string">'一月'</span> &#125;,</span><br><span class="line">&gt;         &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">month</span>: <span class="string">'二月'</span> &#125;,</span><br><span class="line">&gt;         &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">month</span>: <span class="string">'三月'</span> &#125;,</span><br><span class="line">&gt;         &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">month</span>: <span class="string">'四月'</span> &#125;</span><br><span class="line">&gt;       ]</span><br><span class="line">&gt;       setMonthList(monthArr);</span><br><span class="line">&gt;     &#125;, []  );</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>你也可以一开始就渲染好月份的下拉框值，然后等专题年份有值了再去让他可以选择：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;   &lt;Select style=&#123;&#123; width: "10vw" &#125;&#125;  disabled=&#123;!form.getFieldValue('area')&#125;&gt;</span><br><span class="line">&gt;                       &lt;/select&gt;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>然后是<strong>动态表单项的表单项名</strong>必须是：name={[field.name, 表单项名字]}，最后他们都会给加入到sights这个属性的key值里，对应的是sights: [….]</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;  &lt;Form.List name="sights"&gt;</span><br><span class="line">&gt;         &#123;/* Form.List 下的字段需要包裹 Form.List 本身的 nam */&#125;</span><br><span class="line">&gt;   &lt;Form.Item &#123;...field&#125; name=&#123;[field.name, 'subjectYear']&#125; label="专题年份"&gt;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>如果我们动态添加表单项的时候<strong>赋初始值，或者插入到头部</strong>的时候，需要注意这几点：<br> onClick={() =&gt; handleClickAdd(add, fields)} ，需要把add方法传进去</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment">// 处理点击加号，新增</span></span><br><span class="line">&gt;   <span class="keyword">const</span> handleClickAdd = <span class="keyword">async</span> (add, fields) =&gt; &#123;</span><br><span class="line">&gt;     <span class="built_in">console</span>.log(<span class="string">'addd.....'</span>)</span><br><span class="line">&gt;     <span class="built_in">console</span>.log(form.getFieldsValue())</span><br><span class="line">&gt;     <span class="comment">// console.log(form.getFieldValue('sights'));</span></span><br><span class="line">&gt;     <span class="comment">// console.log(form.getFieldValue('sights').length);</span></span><br><span class="line">&gt;     <span class="comment">// 这里的下一个元素是undefined，要赋值为最新的</span></span><br><span class="line">&gt;     <span class="comment">// const oldArr = [...form.getFieldValue('sights')];</span></span><br><span class="line">&gt;     <span class="comment">// console.log(oldArr)</span></span><br><span class="line">&gt;     <span class="comment">// 这是最新添加的表单项的值</span></span><br><span class="line">&gt;     <span class="comment">// const newsObj = form.getFieldValue('sights')[form.getFieldValue('sights').length - 1]</span></span><br><span class="line">&gt;     <span class="comment">// console.log(newsObj)</span></span><br><span class="line">&gt;     <span class="comment">// 触发表单校验</span></span><br><span class="line">&gt;     <span class="keyword">const</span> fieldsValue = <span class="keyword">await</span> form.validateFields();</span><br><span class="line">&gt;     <span class="built_in">console</span>.log(fieldsValue);</span><br><span class="line">&gt;     add(&#123;</span><br><span class="line">&gt;       names: <span class="string">'我是默认的名字'</span>,</span><br><span class="line">&gt;       contain: <span class="string">"Y"</span></span><br><span class="line">&gt;     &#125;, <span class="number">0</span>)</span><br><span class="line">&gt;     <span class="comment">// add: (defaultValue?: StoreValue, insertIndex?: number) =&gt; void;</span></span><br><span class="line">&gt;     <span class="comment">// 【源码中：第一个对象是默认值，后面是插入的位置，我这里是0就每次都插在第一个】</span></span><br><span class="line">&gt;     <span class="comment">/* add(&#123;</span></span><br><span class="line"><span class="comment">&gt;       // subjectName: newsObj.subjectName || fieldsValue.sights[0].subjectName,</span></span><br><span class="line"><span class="comment">&gt;       category: newsObj.category || fieldsValue.sights[0].category,</span></span><br><span class="line"><span class="comment">&gt;       subjectYear: newsObj.subjectYear || fieldsValue.sights[0].subjectYear,</span></span><br><span class="line"><span class="comment">&gt;     &#125;); */</span></span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>如果我们想<strong>添加的最新一行表单项的值是上一行表单项的值</strong>的话这样操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;  <span class="comment">// 这里的下一个元素是undefined，要赋值为最新的</span></span><br><span class="line">&gt;     <span class="keyword">const</span> oldArr = [...form.getFieldValue(<span class="string">'moveSubjectItems'</span>)];</span><br><span class="line">&gt;     <span class="comment">// 这是最新添加的表单项的值</span></span><br><span class="line">&gt;     <span class="keyword">const</span> newsObj = form.getFieldValue(<span class="string">'moveSubjectItems'</span>)[</span><br><span class="line">&gt;       form.getFieldValue(<span class="string">'moveSubjectItems'</span>).length - <span class="number">1</span></span><br><span class="line">&gt;     ];</span><br><span class="line">&gt;     <span class="comment">// console.log(newsObj)</span></span><br><span class="line">&gt;     <span class="comment">// 触发表单校验</span></span><br><span class="line">&gt;     <span class="keyword">const</span> fieldsValue = <span class="keyword">await</span> form.validateFields();</span><br><span class="line">&gt;     <span class="comment">// 设置新的专题年份与专题题材为空</span></span><br><span class="line">&gt;     add(&#123;</span><br><span class="line">&gt;       <span class="comment">// subjectName: newsObj.subjectName || fieldsValue.moveSubjectItems[0].subjectName,</span></span><br><span class="line">&gt;       category: newsObj.category || fieldsValue.moveSubjectItems[<span class="number">0</span>].category,</span><br><span class="line">&gt;       subjectYear: newsObj.subjectYear || fieldsValue.moveSubjectItems[<span class="number">0</span>].subjectYear,</span><br><span class="line">&gt;     &#125;);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
</blockquote>
<p>参考资料：</p>
<p><a href="https://ant.design/components/form-cn/#components-form-demo-dynamic-form-item" target="_blank" rel="noopener">https://ant.design/components/form-cn/#components-form-demo-dynamic-form-item</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2020/11/16/js数据类型的判断/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/11/16/js数据类型的判断/" class="post-title-link" itemprop="url">js数据类型的判断</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-11-16 15:08:28" itemprop="dateCreated datePublished" datetime="2020-11-16T15:08:28+08:00">2020-11-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-03-01 22:40:05" itemprop="dateModified" datetime="2021-03-01T22:40:05+08:00">2021-03-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>如何判断数据类型?</p>
<h1 id="1、typeof"><a href="#1、typeof" class="headerlink" title="1、typeof"></a>1、typeof</h1><blockquote>
<p><strong><code>typeof</code></strong> 操作符返回一个字符串，表示未经计算的操作数的类型。</p>
</blockquote>
<table>
<thead>
<tr>
<th>类型</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>Undefined</td>
<td>undefined</td>
</tr>
<tr>
<td>Null</td>
<td>object</td>
</tr>
<tr>
<td>Boolean</td>
<td>boolean</td>
</tr>
<tr>
<td>Number</td>
<td>number</td>
</tr>
<tr>
<td>BigInt(es2020新增)</td>
<td>bigint</td>
</tr>
<tr>
<td>String</td>
<td>string</td>
</tr>
<tr>
<td>Symbol</td>
<td>symbol</td>
</tr>
<tr>
<td>宿主对象</td>
<td>取决于具体实现</td>
</tr>
<tr>
<td>Function对象</td>
<td>function</td>
</tr>
<tr>
<td>其他任何对象</td>
<td>object</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> []) <span class="comment">// object     []数组的数据类型在 typeof 中被解释为 object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;) <span class="comment">// function</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> &#123;&#125;) <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">undefined</span>) <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">null</span>)<span class="comment">// object     null 的数据类型被 typeof 解释为 object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="string">'1'</span> === <span class="string">'string'</span>) <span class="comment">// true  注意内容为数字的字符串仍是字符串;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 【 使用 Array.isArray 或者 Object.prototype.toString.call】</span></span><br><span class="line"><span class="comment">//  区分数组和普通对象</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call([<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>]));<span class="comment">//[object Array]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(&#123;<span class="attr">a</span>: <span class="number">1</span>&#125;)) <span class="comment">//[object Object]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.isArray([<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>]));<span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.isArray(&#123;&#125;)) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要注意几个例子：用new出来的都是object类型</span></span><br><span class="line"><span class="comment">// 除 Function 外的所有构造函数的类型都是 'object'</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">1</span>) === <span class="string">'object'</span>);<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">'abc'</span>) === <span class="string">'object'</span>);<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Function</span>());<span class="comment">// function</span></span><br></pre></td></tr></table></figure>
<h3 id="1-1-typeof-null"><a href="#1-1-typeof-null" class="headerlink" title="1.1 typeof null"></a>1.1 typeof null</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript 诞生以来便如此</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">null</span> === <span class="string">'object'</span>);<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>在 JavaScript 最初的实现中，JavaScript 中的值是由一个表示类型的标签和实际数据值表示的。对象的类型标签是 0。由于 <code>null</code> 代表的是空指针（大多数平台下值为 0x00），因此，null 的类型标签是 0，<code>typeof null</code> 也因此返回 <code>&quot;object&quot;</code></p>
<h3 id="1-2-语法中的括号"><a href="#1-2-语法中的括号" class="headerlink" title="1.2 语法中的括号"></a>1.2 语法中的括号</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 括号有无将决定表达式的类型。</span></span><br><span class="line"><span class="built_in">console</span>.log( <span class="keyword">typeof</span> <span class="number">99</span> + <span class="string">'pyy'</span>);<span class="comment">// 'numberpyy'</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> (<span class="number">99</span> + <span class="string">'pyy'</span>))<span class="comment">// 'string'</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-typeof错误"><a href="#1-3-typeof错误" class="headerlink" title="1.3 typeof错误"></a>1.3 typeof错误</h3><p>在 ECMAScript 2015 之前，<strong><code>typeof</code> 总能保证对任何所给的操作数返回一个字符串。</strong>即便是没有声明的标识符，<code>typeof</code> 也能返回 <code>&#39;undefined&#39;</code><strong>。使用 <code>typeof</code> 永远不会抛出错误</strong></p>
<p>但在加入了块级作用域的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/let" target="_blank" rel="noopener">let</a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/const" target="_blank" rel="noopener">const</a> 之后，在其被声明之前对块中的 <code>let</code> 和 <code>const</code> 变量使用 <code>typeof</code> 会抛出一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ReferenceError" target="_blank" rel="noopener">ReferenceError</a>。<strong>块作用域变量在块的头部处于“[暂存死区]”，直至其被初始化，在这期间，访问变量将会引发错误</strong></p>
<h4 id="1-3-1-暂存死区"><a href="#1-3-1-暂存死区" class="headerlink" title="1.3.1 暂存死区"></a>1.3.1 暂存死区</h4><p>与通过  <code>var</code> 声明的有初始化值 <code>undefined</code> 的变量不同，通过 <code>let</code> 声明的变量直到它们的定义被执行时才初始化<strong>。在变量初始化前访问该变量会导致 <code>ReferenceError</code>。该变量处在一个自块顶部到初始化处理的“暂存死区”中</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_something</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(bar) <span class="comment">// undefined</span></span><br><span class="line">  <span class="built_in">console</span>.log(foo) </span><br><span class="line">  <span class="comment">//ReferenceError: Cannot access 'foo' before initialization</span></span><br><span class="line">  <span class="keyword">var</span> bar = <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> foo = <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_something</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> foo;</span><br><span class="line">  <span class="comment">//通过 let 声明的变量直到它们的定义被执行时才初始化</span></span><br><span class="line">  <span class="built_in">console</span>.log(foo)<span class="comment">//undefined</span></span><br><span class="line">  foo = <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-2-暂存死区与typeof"><a href="#1-3-2-暂存死区与typeof" class="headerlink" title="1.3.2 暂存死区与typeof"></a>1.3.2 暂存死区与typeof</h4><p>与通过<code>var</code>声明的变量, 有初始化值 <code>undefined</code>和只是未声明的变量不同的是，如果使用<code>typeof</code>检测在暂存死区中的变量, 会抛出<code>ReferenceError</code>异常:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//'undefined'</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> undeclaredVariable)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ReferenceError: Cannot access 'i' before initialization</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> i)</span><br><span class="line"><span class="keyword">let</span> i = <span class="number">10</span></span><br></pre></td></tr></table></figure>
<h1 id="2、instanceof"><a href="#2、instanceof" class="headerlink" title="2、instanceof"></a>2、instanceof</h1><p><strong>运算符</strong>用于检测（构造函数的 <code>prototype</code> 属性）【constructor.prototype】是否出现在某个实例对象的原型链上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span> (<span class="params">make, model, year</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.make = make</span><br><span class="line">  <span class="keyword">this</span>.model = model</span><br><span class="line">  <span class="keyword">this</span>.year = year</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> auto = <span class="keyword">new</span> Car(<span class="string">'Honda'</span>, <span class="string">'Accord'</span>, <span class="number">1998</span>)</span><br><span class="line"><span class="built_in">console</span>.log(auto <span class="keyword">instanceof</span> Car)</span><br><span class="line"><span class="comment">//  true</span></span><br><span class="line"><span class="built_in">console</span>.log(auto <span class="keyword">instanceof</span> <span class="built_in">Object</span>)</span><br><span class="line"><span class="comment">//  true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'abc'</span> <span class="keyword">instanceof</span> <span class="built_in">String</span>) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125; <span class="keyword">instanceof</span> <span class="built_in">Function</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log([] <span class="keyword">instanceof</span> <span class="built_in">Array</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125; <span class="keyword">instanceof</span> <span class="built_in">Object</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>从结果可以看的出只有引用数据类型（Array，Function，Object）可以被判断到，其他的String和Number不能被instanceof判断到</p>
<p><strong>注意：没有用instanceof来判断null和undefined，因为null，undefined不是构造器</strong></p>
<h1 id="3、Object-prototype-toString-call"><a href="#3、Object-prototype-toString-call" class="headerlink" title="3、Object.prototype.toString.call()"></a><strong>3、Object.prototype.toString.call()</strong></h1><blockquote>
<p>toString() 方法返回一个表示该对象的字符串。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在toString没有被重写的情况下打印：[object Object]</span></span><br><span class="line"><span class="keyword">const</span> dog1 = <span class="keyword">new</span> Dog(<span class="string">'Gabby'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(dog1.toString())</span><br><span class="line"><span class="comment">//如果重写了</span></span><br><span class="line">Dog.prototype.toString = <span class="function"><span class="keyword">function</span> <span class="title">dogToString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(dog1.toString())</span><br><span class="line"><span class="comment">//Gabby</span></span><br></pre></td></tr></table></figure>
<p>每个对象都有一个 <code>toString()</code> 方法，当该对象被表示为一个文本值时，或者一个对象以预期的字符串方式引用时自动调用。默认情况下，<strong><code>toString()</code> 方法被每个 <code>Object</code> 对象继承。如果此方法在自定义对象中未被覆盖，<code>toString()</code> 返回 “[object <em>type</em>]”，其中 <code>type</code> 是对象的类型</strong></p>
<h3 id="3-1-使用toString-检测对象类型"><a href="#3-1-使用toString-检测对象类型" class="headerlink" title="3.1 使用toString()检测对象类型"></a>3.1 使用toString()检测对象类型</h3><p>可以通过 <code>toString()</code> 来获取每个对象的类型。为了每个对象都能通过 <code>Object.prototype.toString()</code> 来检测，需要以 <code>Function.prototype.call()</code> 或者 <code>Function.prototype.apply()</code> 的形式来调用，传递要检查的对象作为第一个参数，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> toString = <span class="built_in">Object</span>.prototype.toString</span><br><span class="line">toString.call(<span class="number">123</span>) <span class="comment">// [object Number]</span></span><br><span class="line">toString.call(<span class="string">'abc'</span>) <span class="comment">// [object String]</span></span><br><span class="line">toString.call([]) <span class="comment">// [object Array]</span></span><br><span class="line">toString.call(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;) <span class="comment">// [object Function]</span></span><br><span class="line">toString.call(&#123;&#125;) <span class="comment">// [object Object]</span></span><br><span class="line">toString.call(<span class="literal">undefined</span>) <span class="comment">// [object Undefined]</span></span><br><span class="line">toString.call(<span class="literal">null</span>) <span class="comment">// [object Null]</span></span><br><span class="line"><span class="comment">//内置对象类型也能判断</span></span><br><span class="line">toString.call(<span class="keyword">new</span> <span class="built_in">String</span>()) <span class="comment">// [object String]</span></span><br><span class="line">toString.call(<span class="keyword">new</span> <span class="built_in">Date</span>()) <span class="comment">// [object Date]</span></span><br></pre></td></tr></table></figure>
<p>参考资料：</p>
<p><a href="https://mp.weixin.qq.com/s/qDT4zBxUT-nYCMyrzc-Yaw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/qDT4zBxUT-nYCMyrzc-Yaw</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2020/11/15/js预解析和执行过程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/11/15/js预解析和执行过程/" class="post-title-link" itemprop="url">js预解析和执行过程</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-11-15 15:08:28" itemprop="dateCreated datePublished" datetime="2020-11-15T15:08:28+08:00">2020-11-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-02-27 20:00:52" itemprop="dateModified" datetime="2021-02-27T20:00:52+08:00">2021-02-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="一、变量在内存中的存在形式"><a href="#一、变量在内存中的存在形式" class="headerlink" title="一、变量在内存中的存在形式"></a>一、变量在内存中的存在形式</h1><p>JavaScript中有基本数据类型和引用数据类型。基本数据类型包括：<code>undefined</code>、<code>null</code>、<code>boolean</code>、<code>String</code>、<code>Number</code>；引用数据类型主要是对象（包括{}、[]、Date、Function等）。</p>
<h3 id="1-1-基本类型"><a href="#1-1-基本类型" class="headerlink" title="1.1 基本类型"></a>1.1 基本类型</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> b = a;</span><br><span class="line">b = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<p>从上面的例子，我们可以看出b的值只是a的值的一份拷贝，两个变量的值虽然相等，但是两个变量保存的不同的基本类型的值，b是保存了a的一个副本而已。所以当b改变的时候，a的值是不会改变的，还是10。【基本类型是直接存在栈区】</p>
<h3 id="1-2-引用类型"><a href="#1-2-引用类型" class="headerlink" title="1.2 引用类型"></a>1.2 引用类型</h3><p>【引用数据类型（对象）是存在堆区，变量只是持有该对象的地址而已】</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123; <span class="attr">id</span>: <span class="string">'01'</span>, <span class="attr">name</span>: <span class="string">'pyy'</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = obj1;</span><br><span class="line">obj2.name = <span class="string">'我改名字了'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj1.name); <span class="comment">//'我改名字了'</span></span><br></pre></td></tr></table></figure>
<p>从上面的例子中，我们声明了obj1，并把obj1赋值给了obj2，然后我们修改Obj2的name属性时，obj1的name属性也跟着修改了，说明这两个引用数据类型变量指向着同一个堆内存的对象，obj1赋值给obj2，实际把<strong>这个堆内存对象在栈内存的引用地址复制了一份给了obj2，但它们本质上共同指向了同一个堆内存对象</strong></p>
<h1 id="二、预解析"><a href="#二、预解析" class="headerlink" title="二、预解析"></a>二、预解析</h1><p>概念：<strong>在当前作用域中，JavaScript代码执行之前，浏览器首先会默认的把所有带var和function声明的变量进行提前的声明或者定义。</strong></p>
<h4 id="2-1-声明和定义"><a href="#2-1-声明和定义" class="headerlink" title="2.1. 声明和定义"></a>2.1. 声明和定义</h4><p>var num = 30;</p>
<p>这个代码有两个步骤：声明和定义</p>
<blockquote>
<p><strong>声明</strong>：var num 就是告诉浏览器在全局作用域中有一个num变量，如果只是声明了没有赋值，默认值就是undefined。</p>
<p><strong>定义</strong>：num = 30 就是给变量进行【<strong>赋值</strong>】</p>
</blockquote>
<h4 id="2-2-预解析只发生在当前的作用域下"><a href="#2-2-预解析只发生在当前的作用域下" class="headerlink" title="2.2 预解析只发生在当前的作用域下"></a>2.2 预解析只发生在当前的作用域下</h4><p>这里有个区别：<u>var声明的变量在预解析的时候只是<strong>提前的声明</strong>，function声明的函数在预解析的时候会<strong>提前声明并且会同时定义</strong></u></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(nn); <span class="comment">//undefined</span></span><br><span class="line"><span class="keyword">var</span> nn = <span class="number">30</span>;</span><br><span class="line"><span class="built_in">console</span>.log(nn);<span class="comment">//30</span></span><br><span class="line">sum(<span class="number">100</span>, <span class="number">200</span>);<span class="comment">//300</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> total = num1 + num2;</span><br><span class="line">    <span class="built_in">console</span>.log(total);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一开始只会对window下的全局变量和函数进行预解析，<strong>只有等到函数执行的时候才会对函数的变量和函数进行预解析。</strong></p>
<p>上面的例子：第一次输出nn的时候，由于因为预解析，只是声明了并没有定义。所以输出undefined，，第二次输出nn的时候定义了，输出30。函数的声明和定义是同时进行的，所以sum()虽然在function sum函数声明之前调用的，但是依然会可以正常调用，打印300。</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2020/11/15/js预解析和执行过程/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2020/11/08/react01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/11/08/react01/" class="post-title-link" itemprop="url">react系列01---初见react</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-11-08 10:08:28 / 修改时间：01:04:07" itemprop="dateCreated datePublished" datetime="2020-11-08T10:08:28+08:00">2020-11-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端/" itemprop="url" rel="index"><span itemprop="name">前端</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>开发React必须依赖三个库：</strong></p>
<ol>
<li><p>react：包含react所必须的核心代码</p>
</li>
<li><p>react-dom：react渲染在不同平台所需要的核心代码</p>
</li>
<li><p>babel：将jsx转换成React代码的工具</p>
</li>
</ol>
<hr>
<p><strong>如何添加这三个依赖：</strong></p>
<ul>
<li><p>方式一：直接CDN引入</p>
</li>
<li><ul>
<li>react依赖：<a href="https://unpkg.com/react@16/umd/react.development.js" target="_blank" rel="noopener">https://unpkg.com/react@16/umd/react.development.js</a></li>
<li>react-dom依赖：<a href="https://unpkg.com/react-dom@16/umd/react-dom.development.js" target="_blank" rel="noopener">https://unpkg.com/react-dom@16/umd/react-dom.development.js</a></li>
<li>babel依赖：<a href="https://unpkg.com/babel-standalone@6/babel.min.js" target="_blank" rel="noopener">https://unpkg.com/babel-standalone@6/babel.min.js</a></li>
</ul>
</li>
<li><p>方式二：下载后添加本地依赖</p>
</li>
<li><p>方式三：通过npm管理</p>
</li>
</ul>
<hr>
<h4 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h4><p>下面我们通过一个hello world的案例来实现以下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span>dafdasf<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加React的依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/react@16/umd/react.development.js"</span> <span class="attr">crossorigin</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/react-dom@16/umd/react-dom.development.js"</span> <span class="attr">crossorigin</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/babel-standalone@6/babel.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- crossorigin:因为我们引用了远程的js文件，文件内部可能代码有问题。如果希望在本地这里显示出来错误。 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 注意事项: 使用jsx, 并且希望script中的jsx的代码被解析, 必须在script标签中添加一个属性  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        // <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span>: jsx代码</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> message = <span class="string">"Hello World"</span>;</span></span><br><span class="line"><span class="javascript">    ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;message&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">"app"</span>))</span></span><br><span class="line"><span class="javascript">    <span class="comment">//render(渲染内容，挂载的对象【一般给个id】)，渲染的内容就会覆盖掉id='app'的内容</span></span></span><br><span class="line"><span class="undefined"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>ReactDOM.render函数：</strong></p>
</li>
<li><ul>
<li>定义一个id为app的div</li>
<li>这里我们传入了一个h2元素</li>
<li>参数一：传递要渲染的内容，这个内容可以是HTML元素 / React的组件</li>
<li>参数二：将渲染的内容，挂载到哪一个HTML元素上</li>
</ul>
</li>
</ul>
<hr>
<h4 id="helloword按钮的实现"><a href="#helloword按钮的实现" class="headerlink" title="helloword按钮的实现"></a>helloword按钮的实现</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加React的依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../importjs/react.development.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../importjs/react-dom.development.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../importjs/babel.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 注意事项: 使用jsx, 并且希望script中的jsx的代码被解析, 必须在script标签中添加一个属性  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//  jsx特点：多个标签最外层（根）只能有一个标签</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> message = <span class="string">"Hello World"</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">btnClick</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        message = <span class="string">'我被改变了的内容...'</span>;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//message不会同时更新的，只有重新渲染才能</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//更新数据需要重新渲染一次</span></span></span><br><span class="line"><span class="undefined">        render();</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="undefined">        ReactDOM.render(</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;message&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;btnClick&#125;</span>&gt;</span>改变文本<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">"app"</span>))</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    render();</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 页面加载时渲染一次dom</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="helloworld组件式实现"><a href="#helloworld组件式实现" class="headerlink" title="helloworld组件式实现"></a>helloworld组件式实现</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加React的依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../importjs/react.development.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../importjs/react-dom.development.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../importjs/babel.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 我们想把message和按钮封装成一个组件叫做App</span></span></span><br><span class="line"><span class="javascript">    <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">constructor</span>()&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">super</span>();</span></span><br><span class="line"><span class="javascript">        <span class="comment">//必须先调用下super，初始化父类的实例，才能使用this</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   this.message = 'hellow world'  </span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//在构造函数声明了message，别的地方才可以this.message使用</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//如果想更改数据时，页面也跟着改变数据。要定义在state里</span></span></span><br><span class="line"><span class="javascript">         <span class="keyword">this</span>.state = &#123;</span></span><br><span class="line"><span class="javascript">            message:<span class="string">'hello,world'</span></span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        render()&#123; </span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;this.state.message&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.btnClick.bind(this)&#125;</span>&gt;</span>改变文本<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="undefined">            )</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        btnClick()&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'按钮发生了点击..'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="keyword">this</span>);<span class="comment">//undefined</span></span></span><br><span class="line"><span class="undefined">        /*  内部回调的时候拿不到this。 btnClick.apply(undefined)</span></span><br><span class="line"><span class="javascript">             <span class="keyword">this</span>.message = <span class="string">'改变后的内容...'</span></span></span><br><span class="line"><span class="javascript">         Cannot <span class="keyword">set</span> property 'message' of undefined */</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">       /*   this.render(); 这里调用render没用，相当于把render函数的</span></span><br><span class="line"><span class="undefined">        返回值返回给你 。虚拟dom不知道你要生成最新的jsx。不要手动调用render()</span></span><br><span class="line"><span class="undefined">        */</span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.setState(&#123;</span></span><br><span class="line"><span class="javascript">              message:<span class="string">'66666'</span></span></span><br><span class="line"><span class="undefined">          &#125;)</span></span><br><span class="line"><span class="javascript">          <span class="comment">//这里有点像小程序。内部会进行更新操作</span></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;  </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        ReactDOM.render(</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">App</span>/&gt;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">"app"</span>))</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>使用类的方式封装组件：</strong></p>
<p>render当中返回的jsx内容，就是之后React会帮助我们渲染的内容</p>
<blockquote>
<ul>
<li><small>1、定义一个类，继承自React.Component</small></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><small>2、实现当前组件的render函数</small></li>
</ul>
</blockquote>
<p><strong>参与界面更新的数据我们也可以称之为是参与数据流，这个数据是定义在当前对象的state中</strong></p>
<blockquote>
<ul>
<li><small>1、我们可以通过在构造函数中 <code>this.state = {定义的数据}</code></small></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><small>2、数据发生变化时，可以调用 <code>this.setState</code> 来更新数据，并且通知React进行update操作</small></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><small>3、在进行update操作时，就会重新调用render函数，并且使用最新的数据，来渲染界面</small></li>
</ul>
</blockquote>
<p><strong>事件绑定中的this</strong></p>
<p>类中直接定义一个函数，并且将这个函数绑定到html原生的onClick事件上，当前这个函数的this指向的是谁呢？———–默认情况下是undefined。这次因为React并不是直接渲染成真实的DOM，我们所编写的button只是一个语法糖，它的本质React的Element对象</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2020/09/10/es6(1)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/09/10/es6(1)/" class="post-title-link" itemprop="url">es6总结常用</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-09-10 15:08:28" itemprop="dateCreated datePublished" datetime="2020-09-10T15:08:28+08:00">2020-09-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-10-06 23:55:31" itemprop="dateModified" datetime="2020-10-06T23:55:31+08:00">2020-10-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端/" itemprop="url" rel="index"><span itemprop="name">前端</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="总结一下es6常用的语法"><a href="#总结一下es6常用的语法" class="headerlink" title="总结一下es6常用的语法"></a>总结一下es6常用的语法</h2><p><font size="4" color="Gray"><strong>1、（解构）只要等号两边模式一致，左边变量即可获取右边对应位置的值</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">let [ , , c] = [1, 2, 3];</span><br><span class="line"> console.log(c); // 3</span><br><span class="line"></span><br><span class="line"> let [a1, , c1] = [1, 2, 3];</span><br><span class="line"> console.log(a1,c1); // 1, 3</span><br><span class="line"></span><br><span class="line"> let [a2, ...b2] = [1, 2, 3];</span><br><span class="line"> console.log(a2,b2); // 1, [2,3]</span><br><span class="line"></span><br><span class="line"> let [a, b, ..c.] = [1];</span><br><span class="line"> console.log(a, b, c); // 1, undefined, [] </span><br><span class="line"> 【如果解构不成功，变量的值就等于undefined。】</span><br><span class="line"></span><br><span class="line"> let [a] = []; // a =&gt; undefined</span><br><span class="line"> let [a, b] = [1]; // a =&gt; 1 , b =&gt; </span><br><span class="line"> </span><br><span class="line">【 注意：两边模式不同时，会报错：】</span><br><span class="line"> 例子：let [a] =1 ;let [a] =false;</span><br><span class="line"> let [a] =NaN ; let [a] = null; let [a] = &#123;&#125;;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<ul>
<li><font size="3" color="Gray"><strong> 1.2、数组指定解构的默认值，左边声明默认值，如果右边没赋值就取默认：</strong></font> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let [a = 1] = []; // a =&gt; 1</span><br><span class="line">let [a, b = 2] = [a]; // a =&gt; 1 , b =&gt; 2</span><br><span class="line"></span><br><span class="line">【注意：有两个特殊情况：</span><br><span class="line">**【1、右边模式对应的值，必须严格等于undefined，</span><br><span class="line">默认值才能生效；2、而null不严格等于undefined 】</span><br><span class="line"></span><br><span class="line">let [a = 1] = [undefined]; // a =&gt; 1</span><br><span class="line">let [a = 1] = [null]; // a =&gt; null</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p><font size="4" color="Gray"><strong> 2、对象的解构赋值：只要按照变量名去取对应属性名的值，</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">      let &#123;a, b&#125; = &#123;a:1, b:2&#125;; // a =&gt; 1 , b =&gt; 2</span><br><span class="line">      let &#123;a&#125; = &#123;a:3, b:2, c:1&#125;;// a =&gt; 3</span><br><span class="line">      let &#123;a&#125; = &#123;b:2, c:1&#125;; // a =&gt; undefined</span><br><span class="line"></span><br><span class="line">【注意：如果我们想赋值给新的变量：</span><br><span class="line">        let &#123;a:b&#125; = &#123;a:1, c:2&#125;;</span><br><span class="line">        console.log(&#123;b&#125;);</span><br><span class="line">       //&#123;b: 1&#125; 先找到a的属性名，然后赋值，再赋值给b】</span><br></pre></td></tr></table></figure></p>
<blockquote>
<ul>
<li><font size="3" color="Gray"><strong> 2.1:对象指定解构的默认值：</strong></font> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> let &#123;a=1&#125; = &#123;&#125;; // a =&gt; 1</span><br><span class="line">let &#123;a, b=1&#125; = &#123;a:2&#125;; // a =&gt; 2, b =&gt; 1</span><br><span class="line"></span><br><span class="line">let &#123;a:b=3&#125; = &#123;&#125;; // b =&gt; 3</span><br><span class="line">let &#123;a:b=3&#125; = &#123;a:4&#125;; // b = &gt;4</span><br><span class="line">// 【a是匹配模式，b是变量】</span><br><span class="line"></span><br><span class="line">let &#123;a=1&#125; = &#123;a:undefined&#125;; // a =&gt; 1</span><br><span class="line">let &#123;a=1&#125; = &#123;a:null&#125;; // a =&gt; null</span><br><span class="line">// 因为null与undefined不严格相等，所以赋值有效</span><br><span class="line"></span><br><span class="line">let obj = &#123;</span><br><span class="line">     a:[ 1, &#123; b: 2&#125;]</span><br><span class="line">&#125;;</span><br><span class="line">let &#123;a, a: [c, &#123;b&#125;]&#125; = obj;</span><br><span class="line">//对象的数组只有c和1对应的上，然后</span><br><span class="line">// a=&gt;[1, &#123;b: 2&#125;], b =&gt; 2, c =&gt; 1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p><font size="4" color="Gray"><strong> 3、字符串的解构赋值中，有个Key为length可以得到转换成数组的长度</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let &#123;length:len&#125; = &apos;hello&apos;;// len =&gt; 5</span><br><span class="line">      console.log(len);</span><br><span class="line">      let &#123;length:len1&#125; = [1,2,3,4,5,6,7,7];</span><br><span class="line">      console.log(len1);//8</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>  4、数值和布尔值的解构赋值</strong></font><br>【只要等号右边的值不是对象或数组，就先将其转为对象】<br>【undefined和null无法转为对象，所以对它们进行解构赋值，都会报错】<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let &#123;length:len&#125; = &apos;hello&apos;;// len =&gt; 5</span><br><span class="line">  console.log(len);</span><br><span class="line">  let &#123;length:len1&#125; = [1,2,3,4,5,6,7,7];</span><br><span class="line">  console.log(len1);//8</span><br><span class="line"></span><br><span class="line">   let &#123;toString: s&#125; = 123;</span><br><span class="line">   //包装对象有toString属性</span><br><span class="line">   console.log(s === Number.prototype.toString)//true</span><br><span class="line">    </span><br><span class="line">  【undefined和null无法转为对象，所以对它们进行解构赋值】</span><br><span class="line">   let &#123; prop: x &#125; = undefined; // TypeError</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong> 5、函数参数的解构赋值</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function fun ([a, b])&#123;</span><br><span class="line">         return a + b;</span><br><span class="line">     &#125;</span><br><span class="line"> fun ([2, 3]); // 5</span><br></pre></td></tr></table></figure></p>
<blockquote>
<ul>
<li><font size="3" color="Gray"><strong>5.1：默认值的解构:</strong></font> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function fun (&#123;a=0, b=0&#125; = &#123;&#125;)&#123;</span><br><span class="line">         //参数右边= &#123;&#125; 等价于这两句：</span><br><span class="line">         //【 let aa = &#123;&#125;;   fun(aa)】</span><br><span class="line">          return [a, b];</span><br><span class="line">    &#125;</span><br><span class="line">      fun (&#123;a:1, b:2&#125;);// [1, 2]</span><br><span class="line">      fun (&#123;a:1&#125;); // [1, 0]</span><br><span class="line">      fun (&#123;&#125;); // [0, 0]</span><br><span class="line">      fun (); // [0, 0]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p><font size="4" color="Gray"><strong> 6、【应用1：函数返回多个值】</strong>：</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">  // 【返回一个数组】</span><br><span class="line">  function f ()&#123;</span><br><span class="line">      return [1, 2, 3];</span><br><span class="line">  &#125;</span><br><span class="line">  let [a, b, c] = f(); // a=&gt;1, b=&gt;2, c=&gt;3</span><br><span class="line"></span><br><span class="line">  //【 返回一个对象】常用</span><br><span class="line">  function f ()&#123;</span><br><span class="line">    return &#123;a:1, b:2&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  let &#123;a, b&#125; = f(); // a=&gt;1, b=&gt;2</span><br><span class="line"></span><br><span class="line">  //【快速的将一组参数与变量名对应】常用</span><br><span class="line">    function f([a, b, c]) &#123;</span><br><span class="line">        console.log(&apos;&apos;+a+&quot;,&quot;+b);</span><br><span class="line">    &#125;</span><br><span class="line">    f([1, 2, 3]);//1,2</span><br><span class="line">    function f2(&#123;age=990,name&#125;) &#123;</span><br><span class="line">        console.log(&apos;&apos;+age+&quot;,&quot;+name);</span><br><span class="line">    &#125;</span><br><span class="line">    f2(&#123;age:18,name:&apos;lixun&apos;&#125;);//18,lixun</span><br><span class="line">    f2(&#123;name:&apos;lixun&apos;&#125;);//990,lixun 没传age就用默认的990</span><br><span class="line"></span><br><span class="line">  //【提取JSON数据：】</span><br><span class="line">    let json1 = &#123;</span><br><span class="line">       name : &apos;lixun&apos;,</span><br><span class="line">       age: 19</span><br><span class="line">    &#125;</span><br><span class="line">    let &#123;name, age&#125; = json1; // lixun,19</span><br><span class="line"> </span><br><span class="line">  //【遍历Map结构】</span><br><span class="line">    const m = new Map();</span><br><span class="line">    m.set(&apos;aa&apos;,1);</span><br><span class="line">    m.set(&apos;bb&apos;,2);</span><br><span class="line">    for (let [k, v] of m)&#123;</span><br><span class="line">        console.log(k + &apos; : &apos; + v);</span><br><span class="line">    &#125;</span><br><span class="line">    // 【获取键的名称】</span><br><span class="line">    for (let [k] of m)&#123;</span><br><span class="line">        console.log(k);</span><br><span class="line">    &#125;</span><br><span class="line">    // 获取值的名称：for (let [,k] of m)</span><br><span class="line"></span><br><span class="line">//【导入模块的指定方法】常用】</span><br><span class="line">    const &#123;add&#125; = require(&apos;Math&apos;);</span><br></pre></td></tr></table></figure></p>
<p> <font size="4" color="Gray"><strong> 7、字符串的拓展 </strong></font><br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let a = &apos;hello lx&apos;;</span><br><span class="line">a.startsWith(&apos;lx&apos;); // false 【是否找到参数字符串】</span><br><span class="line">a.endsWith(&apos;x&apos;); // true</span><br><span class="line">a.includes(&apos;lx&apos;); // true</span><br><span class="line">	</span><br><span class="line">【这三个方法都支持第二个参数，表示起始搜索的位置】。</span><br><span class="line">  let a = &apos;hellolxhahahah&apos;;</span><br><span class="line">  console.log(a.includes(&apos;lx&apos;,8)); // false</span><br><span class="line">	</span><br><span class="line">【repeat方法返回一个新字符串，表示将原字符串重复n次】</span><br><span class="line"> &apos;abc&apos;.repeat(3); // &apos;abcabcabc&apos;</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>8、模版字符串</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let v1 = &apos;zhh&apos;;</span><br><span class="line"> // 【拼接变量】</span><br><span class="line"> let a = `abc$&#123;v1&#125;def`</span><br></pre></td></tr></table></figure></font></p>
<p><font size="4" color="Gray"><strong>9、正则的拓展【第一个参数：字符串，第二个参数：正则的修饰符</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let a = new RegExp(&apos;aaa&apos;, &apos;i&apos;);</span><br><span class="line">// 等价于</span><br><span class="line">let a = /aaa/i;</span><br><span class="line"></span><br><span class="line">【只能有一个参数：正则表达式】</span><br><span class="line">let a = new RegExp(/abc/i);</span><br><span class="line">//等价于</span><br><span class="line">let a = /abx/i;</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>10、数值：Number.parseInt(), Number.parseFloat()方法</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">   parseInt(&apos;123.34&apos;); // 123</span><br><span class="line">   parseFloat(&apos;123.456#&apos;); // 123.456</span><br><span class="line"></span><br><span class="line">   Number.parseInt(&apos;12.345&apos;); // 12</span><br><span class="line">   Number.parseFloat(&apos;123.456##&apos;); // 123.456</span><br><span class="line">  </span><br><span class="line">  【用来判断一个数值是否是整数： Number.isInteger】</span><br><span class="line">    Number.isInteger(10); // true</span><br><span class="line">    Number.isInteger(10.0); // true</span><br><span class="line"></span><br><span class="line">  【Math.trunc:去除小数的小数部分，返回整数。</span><br><span class="line">   1、 若为非数值，先转为数值。</span><br><span class="line">   2、 为空值或无法截取整数的值，返回NaN】</span><br><span class="line">      console.log(Math.trunc(1.1)); //1</span><br><span class="line">      console.log(Math.trunc(true)); //1</span><br><span class="line">      console.log(Math.trunc(NaN)); //NaN</span><br><span class="line"></span><br><span class="line">  【Math.sign():判断一个数是正数、负数还是零；非数值，</span><br><span class="line">会先转成数值 正数返回+1，负数返回-1，为0返回0，其他返回NaN】</span><br><span class="line">      Math.sign(-1); // -1</span><br><span class="line">      Math.sign(1); // +1</span><br><span class="line">      Math.sign(0); // 0</span><br><span class="line">      Math.sign(NaN); // NaN</span><br><span class="line">      Math.sign(true); // +1</span><br><span class="line">      Math.sign(false);// 0</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong> 11、函数拓展，默认值</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">【参数变量是默认声明的，不能用let和const再次声明：</span><br><span class="line">     function f(a1, b1=&apos;lx&apos;)&#123;</span><br><span class="line">         console.log(a1, b1);</span><br><span class="line">     &#125;</span><br><span class="line">     f(&apos;hii&apos;)//hii lx</span><br><span class="line">     f(&apos;hii&apos;,&apos;zhh&apos;)//hii zhh</span><br><span class="line"></span><br><span class="line">  与解构赋值默认值结合使用：</span><br><span class="line">     function f (&#123;a, b=1&#125;)&#123;</span><br><span class="line">          console.log(a,b)</span><br><span class="line">     &#125;;</span><br><span class="line">     f(&#123;&#125;); // undefined 1</span><br><span class="line">     f(&#123;a:2&#125;); // 2 1</span><br><span class="line">     f(&#123;a:2, b:3&#125;); // 2 3</span><br><span class="line">     f(); // 报错</span><br><span class="line">     </span><br><span class="line">   【rest参数只能放在最后一个】</span><br><span class="line">  function f2 (a,...b)&#123;</span><br><span class="line">       console.log(f2.length);//1</span><br><span class="line">  &#125;;//函数的length属性不包含rest参数</span><br><span class="line">  f2(1,[2,3,4]); // 1</span><br><span class="line"></span><br><span class="line">  function f22 (a,b,c)&#123;</span><br><span class="line">       console.log(f22.length);//3</span><br><span class="line">   &#125;;</span><br><span class="line">   f22(234,4,5)</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong> 12、【扩展运算符】重要!</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">例子1 ： let a = [1, 2, 3, 4, 5]</span><br><span class="line">   console.log(a);    //[ 1, 2, 3, 4, 5 ]</span><br><span class="line">   console.log(...a);    // 1, 2, 3, 4, 5 </span><br><span class="line"> </span><br><span class="line">例子2 ： let a = [1, 2, 3]</span><br><span class="line">   let b = [1, 4]</span><br><span class="line">   let c = [...a, ...b]</span><br><span class="line">   console.log(c);    // [1,2,3,1,4]</span><br><span class="line"> </span><br><span class="line">例子3 ：let obj1 = &#123;</span><br><span class="line">           &quot;name&quot;: &quot;lx&quot;,</span><br><span class="line">           &quot;age&quot;: 18,</span><br><span class="line">           &quot;sex&quot;: &quot;nan&quot;</span><br><span class="line">       &#125;</span><br><span class="line">       let obj2 = &#123;</span><br><span class="line">           &quot;name&quot;: &quot;zhh&quot;,</span><br><span class="line">           &quot;age&quot;: 28</span><br><span class="line">       &#125;</span><br><span class="line">       let obj3 = &#123;</span><br><span class="line">           ...obj1,</span><br><span class="line">           ...obj2</span><br><span class="line">       &#125;</span><br><span class="line">       console.log(obj3);</span><br><span class="line">       //如果有相同属性Key，后面的会把前面的覆盖掉</span><br><span class="line">       //&#123;name: &quot;zhh&quot;, age: 28, sex: &quot;nan&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<ul>
<li>【扩展运算符应用1：数组扩展为对象】<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   let a = [11, 22, 33]</span><br><span class="line">    let b = [2, 44,55,66]</span><br><span class="line">    let c = &#123;</span><br><span class="line">        ...a,</span><br><span class="line">        ...b</span><br><span class="line">    &#125;</span><br><span class="line">console.log(c);//&#123;0: 2, 1: 44, 2: 55, 3: 66&#125;</span><br><span class="line">//以a和b长的那个数组为新的数组长度，然后后面的...b会覆盖相同</span><br><span class="line">//索引上的...a上。这里2会覆盖11，44覆盖22，以此类推..</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>【扩展运算符应用2：添加属性、在克隆的同时添加额外的属性】重要▲<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const user = &#123;id:02,name:&apos;lxx&apos;&#125;;</span><br><span class="line">const userNew = &#123;...user,sex:&apos;woman&apos;&#125;</span><br><span class="line">console.log(userNew);</span><br><span class="line">//&#123;id: 2, name: &quot;lxx&quot;, sex: &quot;woman&quot;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>【扩展运算符应用3：合并两个对象为一个新的对象】<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  const part1 = &#123; id: 11, name: &apos;pengyuyan&apos; &#125;</span><br><span class="line">  const part2 = &#123; id: 12, password: &apos;wuyanzu&apos; &#125;</span><br><span class="line">  const user1 = &#123; ...part1, ...part2 &#125;</span><br><span class="line">  console.log(user1);</span><br><span class="line">// &#123; id: 12, name: &quot;pengyuyan&quot;, password: &quot;wuyanzu&quot; &#125;  </span><br><span class="line">  也可以用这种写法：</span><br><span class="line">  const user = &#123; ...p1, ...&#123; id: 12, password: &apos;wuyanzu&apos; &#125; &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>【扩展运算符应用4：利用…删除对象的属性】<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">            let student = &#123;</span><br><span class="line">                     age: 18,</span><br><span class="line">                     name: &apos;kysue&apos;,</span><br><span class="line">                     sex: &quot;男&quot;</span><br><span class="line">                 &#125;</span><br><span class="line">               const noAge = (&#123; age, ...params &#125;) =&gt;rest;</span><br><span class="line">              let re1 = noAge(student);</span><br><span class="line">【//你可以看成&#123;age,...rest&#125;=&#123;age:18,name:&apos;kysue&apos;,sex:&apos;男&apos;&#125;】</span><br><span class="line">【//因为age对应到了，所以剩下的拓展rest就是除了age以外的所有属性。】</span><br><span class="line">              console.log(params);//过滤掉了age的属性</span><br><span class="line">           </span><br><span class="line">          【let getFullName = (&#123;first, last&#125;) =&gt; first + &apos; &apos; + last</span><br><span class="line"></span><br><span class="line">             function getFullName(str) &#123;</span><br><span class="line">                 let &#123;first, last&#125; = str;</span><br><span class="line">                 return first + &apos; &apos; + last;</span><br><span class="line">             &#125; 】 这个例子很重要！！常用</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>【扩展运算符应用5：属性排序】<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  const user3 = &#123;</span><br><span class="line">        password: &apos;Password&apos;,</span><br><span class="line">        name: &apos;lx&apos;,</span><br><span class="line">        id: 33</span><br><span class="line">    &#125;</span><br><span class="line">    //可以将属性放到顶部或者底部</span><br><span class="line">    //先添加 key: undefined 到新对象，从而将 key 移到最前面</span><br><span class="line">    const organize = object =&gt; (&#123; id: undefined, ...object &#125;);</span><br><span class="line">//object是参数，后面是return (&#123; id: undefined, ...object &#125;)。他简便写法</span><br><span class="line">    let rs1 = organize(user3);</span><br><span class="line">    console.log(rs1);</span><br><span class="line"></span><br><span class="line">   //【如果想把解构出来的password属性放最后可以这样：</span><br><span class="line">    const org = (&#123; password, ...obj &#125;) =&gt;(&#123; ...obj, password &#125;)</span><br><span class="line">    //【想让默认值放到首位也可以这样写】</span><br><span class="line">  const setDefa = (&#123; ...obj&#125;) =&gt; (&#123; shuzu: [], ...obj &#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>【扩展运算符应用6：重命名属性】<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const rename = (&#123; ID, ...obj &#125;) =&gt; (&#123; iid: ID, ...obj &#125;)</span><br><span class="line">     const user = &#123;</span><br><span class="line">         ID: 500,</span><br><span class="line">         name: &quot;lxx&quot;</span><br><span class="line">     &#125;</span><br><span class="line">     //返回重命名属性的时候，左边iid是新的属性名，右边ID是值</span><br><span class="line">     console.log(rename(user)) //&#123;iid: 500, name: &quot;lxx&quot;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>【扩展运算符应用7：替代apply方法】 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">           // ES6之前</span><br><span class="line">                    function f(a, b, c) &#123;</span><br><span class="line">                        console.log(&#123;a,b,c&#125;);</span><br><span class="line">                    &#125;;</span><br><span class="line">                    var a = [1, 2, 3];</span><br><span class="line">                    f.apply(null, a);</span><br><span class="line">            // ES6之后</span><br><span class="line">                    f(...aaa);</span><br><span class="line"></span><br><span class="line">// ES6之前:由于 JavaScript 数组没有 max() 方法，因此您可以应用 Math.max() 方法</span><br><span class="line">//第一个参数（null）无关紧要,传什么都可以，最终返回都是6</span><br><span class="line">                    Math.max.apply(null, [3, 2, 6]);</span><br><span class="line">            // ES6之后</span><br><span class="line">                    Math.max(...[3, 2, 6]);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>【扩展运算符应用8：实现深拷贝, 拓展运算符 深拷贝】<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let a1 = [1,2]</span><br><span class="line"> let a2 =[...a1];</span><br><span class="line"> a2[0] = 520;</span><br><span class="line"> console.log(a1,a2);</span><br><span class="line"> // [1, 2]    [520, 2]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p><font size="4" color="Gray"><strong>13、 Array.from()方法：将类数组对象和可遍历的对象转成真正的数组</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  let a = &#123;</span><br><span class="line">          &apos;0&apos;: &apos;a&apos;,</span><br><span class="line">          &apos;1&apos;: &apos;b&apos;,</span><br><span class="line">          length: 2</span><br><span class="line">      &#125;</span><br><span class="line">  let arr = Array.from(a);</span><br><span class="line"></span><br><span class="line">【Array.of():将一组数值，转换成数组】</span><br><span class="line">      let res = Array.of(1,2,3)</span><br><span class="line">      console.log(res);</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>14、 find()和findIndex()   </strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">find():用于找出【第一个符合】条件的数组成员,没有一个符合则返回undefined</span><br><span class="line"></span><br><span class="line">       let res =  [1, 2, 3, 4, 5].find((value, index, arr) =&gt; &#123;</span><br><span class="line">           //当前值、当前位置和原数组</span><br><span class="line">               return value &gt; 4</span><br><span class="line">           &#125;);</span><br><span class="line">   findIndex():返回找到的元素的索引值。</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>15、entries(),keys(),values()</strong><br>          entries()对键值对遍历，keys()对键名遍历，values()对键值遍历。</font></p>
<pre><code>for (let i of [&apos;a&apos;, &apos;b&apos;].keys()) {
        console.log(i)// 0 1
    }
</code></pre><p><font size="4" color="Gray"><strong>16、对象的简洁表示：</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">let b =&#123;a&#125; 等价于 let b = &#123;a:a&#125;</span><br><span class="line"></span><br><span class="line">function f (a,b)&#123;</span><br><span class="line">    return &#123;a,b&#125;</span><br><span class="line">&#125;  </span><br><span class="line">等价于：</span><br><span class="line">function f (a, b)&#123;</span><br><span class="line">   return &#123;a:a ,b:b&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let a =&#123;</span><br><span class="line">    fun()&#123;</span><br><span class="line">        alert(&apos;hi&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">等价于：</span><br><span class="line">let a =&#123;</span><br><span class="line">    fun:function()&#123;</span><br><span class="line">        alert(&apos;hi&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>17、Object.assign()用于对象的合并，将原对象的所有可枚举属性复制到目标对象。</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">【 用法1：第一个参数:目标对象，第二个参数，源对象。】</span><br><span class="line">  let a = &#123;aa:1&#125;;</span><br><span class="line">  let b = &#123;bb:2&#125;;</span><br><span class="line">  Object.assign(a,b); //&#123;aa: 1, bb: 2&#125;</span><br><span class="line"> </span><br><span class="line">    let a = &#123; a: 1, b: 2 &#125;;</span><br><span class="line">    let b = &#123; b: 3, c: 4 &#125;;</span><br><span class="line">    console.log( Object.assign(a, b));</span><br><span class="line">    //&#123;a: 1, b: 3, c: 4&#125; 如果有同名，后面的会覆盖前面的</span><br><span class="line">  </span><br><span class="line"> 【 用法2：复制一个对象】</span><br><span class="line">   const obj = &#123; a: 1 &#125;;</span><br><span class="line">    const copy = Object.assign(&#123;&#125;, obj);</span><br><span class="line">    console.log(copy); // &#123; a: 1 &#125;</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>18、【Set数据结构类似数组，但所有成员的【值唯一】</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">【去掉重复的值】</span><br><span class="line"> let a = new Set();</span><br><span class="line"> [1,2,3,4,1,5,7,7].forEach(v=&gt;a.add(v));</span><br><span class="line"> for (const k of a) &#123;</span><br><span class="line">     console.log(k); </span><br><span class="line"> &#125;</span><br><span class="line"> 【例子1：】</span><br><span class="line">  数组去重：</span><br><span class="line">  [...new Set([1,2,3,4,1,7])]</span><br><span class="line">  Array.from(new Set([1,2,3,4,1,5,6]))</span><br><span class="line"></span><br><span class="line">  注意：向Set中添加值的时候，不会类型转换，即6和&apos;6&apos;是不同的</span><br><span class="line"> console.log([...new Set([6, &apos;6&apos;])]);//[6, &quot;6&quot;]</span><br><span class="line">    </span><br><span class="line">   【 filter 过滤】</span><br><span class="line"> let a = new Set([1, 2, 3, 4]);</span><br><span class="line"> let c = new Set([...a].filter(x =&gt; (x % 2) == 0)); </span><br><span class="line"> console.log(c);//Set(2) &#123;2, 4&#125;</span><br><span class="line"></span><br><span class="line"> let a = new Set();【has()表示该值是否为Set的成员】</span><br><span class="line"> a.add(1).add(2); // a =&gt; Set(2) &#123;1, 2&#125;</span><br><span class="line"> a.has(2);        // true</span><br><span class="line"> a.has(3);        // false</span><br><span class="line"></span><br><span class="line"> 【可以使用for...of直接遍历Set。】</span><br><span class="line"> let a = new Set([&apos;a&apos;,&apos;b&apos;,&apos;c&apos;]);</span><br><span class="line"> for(let k of a)&#123;console.log(k)&#125;;</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>19、map() 方法创建一个新数组，其结果是该数组中的每个元素都调用一个提供的函数后返回的结果</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var array1 = [1, 4, 9, 16];</span><br><span class="line">   const map1 = array1.map(x =&gt; &#123;</span><br><span class="line">       if (x == 4) &#123;</span><br><span class="line">           return x * 2;</span><br><span class="line">       &#125;</span><br><span class="line">       return x;</span><br><span class="line">   &#125;);</span><br><span class="line">console.log(map1);//(4) [1, 8, 9, 16]</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>20、Map类型，值—值，使得各种类型的值(包括对象)都可以作为键</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">let a =new Map();</span><br><span class="line">let bb = &#123;name:&apos;pyy&apos;&#125;</span><br><span class="line">a.set(bb,&quot;my lix&quot;);</span><br><span class="line">console.log(a.get(bb));</span><br><span class="line">console.log(a.has(&quot;cc&quot;));//false</span><br><span class="line"></span><br><span class="line">【  let a = new Map();</span><br><span class="line">        a.set(0, &quot;zero&quot;);</span><br><span class="line">        a.set(1, &quot;one&quot;)</span><br><span class="line">      for (let i of a.values()) &#123; console.log(i); &#125;;</span><br><span class="line">        // zero</span><br><span class="line">        for (let i of a.entries()) &#123; console.log(i); &#125;;</span><br><span class="line">        // [0, &quot;zero&quot;]</span><br><span class="line">        a.forEach((v, k, m) =&gt; &#123;</span><br><span class="line">            console.log(`key:$&#123;k&#125;,value:$&#123;v&#125;,map:$&#123;m&#125;`)</span><br><span class="line">           // key: 0, value: zero, map: [object Map]</span><br><span class="line">        &#125;) </span><br><span class="line">】</span><br></pre></td></tr></table></figure></p>
<p><font size="4" color="Gray"><strong>场景1：当我们在request传参的时候，想在header基础上带上其他参数：</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function request(params)&#123;</span><br><span class="line">   let header1 = &#123;...params.header&#125;;</span><br><span class="line">   header1[&apos;Author&apos;] = &apos;author8888&apos;;</span><br><span class="line">         console.log(header1);</span><br><span class="line"> //&#123;style: &quot;css&quot;, Author: &quot;author8888&quot;&#125;</span><br><span class="line">&#125;</span><br><span class="line">request(&#123;url:&quot;/my/title&quot;,header:&#123;style:&quot;css&quot;&#125;&#125;)</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/asyn2.jpg" alt="image2"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2019/05/01/xuecheng3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/01/xuecheng3/" class="post-title-link" itemprop="url">用户认证与授权</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-01 00:43:01" itemprop="dateCreated datePublished" datetime="2019-05-01T00:43:01+08:00">2019-05-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-13 01:08:04" itemprop="dateModified" datetime="2019-06-13T01:08:04+08:00">2019-06-13</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><strong>什么是有状态的登陆？</strong><br><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;解释：服务端需要记录每次会话的客户端信息，从而识别客户端身份，根据用户身份进行请求的处理，例如tomcat的session。 用户登陆后，我们把登陆者的信息保存在服务端session中，并赋给用户一个cookie值，记录对应的session。然后下次请求，用户携带cookie请求，我们就能识别到对应的session，从而找到用户的信息</small><br><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;缺点：服务端需要存大量数据，增加服务端压力，客户端请求依赖服务端</small></p>
<p><strong>什么是无状态的登陆？</strong><br><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;微服务集群中的每个服务，对外提供的都是Rest风格的接口。而Rest风格的一个最重要的规范就是：服务的无状态性，即：</small></p>
<blockquote>
<ul>
<li><small>1 ): 服务端不保存任何客户端请求者信息</small></li>
<li><small>2 ): 客户端的每次请求必须具备自描述信息，通过这些信息识别客户端身份</small></li>
</ul>
</blockquote>
<p><strong>加密算法</strong><br><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;解释：加密技术是对信息进行编码和解码的技术，编码是把明文译成密文，其逆过程就是解码（解密）</small></p>
<blockquote>
<ul>
<li><small>1 ):对称加密，如AES；基本原理：将明文分成N个组，然后使用密钥对各个组进行加密，形成各自的密文，最后把所有的分组密文进行合并，形成最终的密文。</small></li>
<li><small>2 ):非对称加密，如RSA ；基本原理：同时生成两把密钥：私钥和公钥，私钥隐秘保存，公钥可以下发给信任客户端，私钥加密，持有私钥或公钥才可以解密，公钥加密，持有私钥才可解密</small></li>
<li><small>3 ):不可逆加密，如MD5，SHA； 基本原理：加密过程中不需要使用密钥，输入明文后由系统直接经过加密算法处理成密文，这种加密后的数据。是无法被解密的，无法根据密文推算出明文</small>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/05/01/xuecheng3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </li></ul></blockquote></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2019/04/21/dxc2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/21/dxc2/" class="post-title-link" itemprop="url">CountDownLatch</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-21 00:43:01 / 修改时间：02:00:50" itemprop="dateCreated datePublished" datetime="2019-04-21T00:43:01+08:00">2019-04-21</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>CountDownLatch<br><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CountDownLatch是通过一个计数器来实现的，计数器的初始化值为线程的数量。每当一个线程完成了自己的任务后，计数器的值就相应得减1。当计数器到达0时，表示所有的线程都已完成任务，然后在闭锁上等待的线程就可以恢复执行任务。”【1】举一个例子就是：CountDownLatch 就像裁判，三个方法运动员，运动员2,3都到达终点，但是运动员1摔了。裁判员只看到两位运动员到达终点不能宣布比赛结束，所以一直在等待阻塞。。。 </small><br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/04/21/dxc2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weibo.com/2414189922/profile?topnav=1&wvr=6/2019/04/21/dxc3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="彭摆鱼">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Asteryxx">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/21/dxc3/" class="post-title-link" itemprop="url">Semaphore</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-21 00:43:01 / 修改时间：02:00:56" itemprop="dateCreated datePublished" datetime="2019-04-21T00:43:01+08:00">2019-04-21</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>Semaphore<br><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Semaphore（信号量）是用来控制同时访问特定资源的线程数量，如果将给定许可数设置为1，就如同一个单例模式，即单个停车位，只有一辆车进，然后这辆车出来后，下一辆车才能进。就如同停车场系统一般，而Semaphore则相当于看守的人，用于控制总共允许停车的停车位的个数，而对于每辆车来说就如同一个线程，线程需要通过acquire()方法获取许可，而release()释放许可。如果许可数达到最大活动数，那么调用acquire()之后，便进入等待队列，等待已获得许可的线程释放许可，从而使得多线程能够合理的运行 </small><br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/04/21/dxc3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://img2.touxiang.cn/file/20190112/a7383e05dfbb87c3d10a652c92c6d329.jpg" alt="彭摆鱼">
            
              <p class="site-author-name" itemprop="name">彭摆鱼</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">28</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/asteryxxx" title="GitHub &rarr; https://github.com/asteryxxx" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="/437767931@qq.com" title="E-Mail &rarr; 437767931@qq.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/yourname" title="Weibo &rarr; https://weibo.com/yourname"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://pyy.com" title="http://pyy.com" rel="noopener" target="_blank">pengyuyan</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">彭摆鱼</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.0.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  











  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/three/three.min.js"></script>

  
  <script src="/lib/three/three-waves.min.js"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>




  

  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>


  
  



  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  

  

   <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas> 
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
   <script type="text/javascript" src="/js/src/love.js"></script>



<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

</body>
</html>

